<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relat√≥rio Confidencial - SierComp4ny</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Playfair+Display:ital,wght@1,600&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .serif { font-family: 'Playfair Display', serif; }
        .bg-gradient-brand { background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%); }
    </style>
</head>
<body class="text-gray-800">

    <header class="bg-gray-900 text-white py-6">
        <div class="max-w-3xl mx-auto px-6 flex justify-between items-center">
            <div>
                <h1 class="text-xl font-bold tracking-wider">SIERCOMP4NY</h1>
                <p class="text-xs text-gray-400">Intelligence & Growth</p>
            </div>
            <div class="text-right">
                <p class="text-xs uppercase text-gray-400">Relat√≥rio Confidencial</p>
                <p id="data-hoje" class="text-sm font-semibold">Carregando...</p>
            </div>
        </div>
    </header>

    <main class="max-w-3xl mx-auto px-6 py-10">

        <div id="loading" class="text-center py-20">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-900 mx-auto"></div>
            <p class="mt-4 text-gray-500">Decodificando sua mente...</p>
        </div>

        <div id="conteudo" class="hidden space-y-8">
            
            <div class="text-center">
                <span class="bg-blue-100 text-blue-800 text-xs font-bold px-3 py-1 rounded-full uppercase">Resultado da An√°lise</span>
                <h1 id="titulo-perfil" class="text-4xl font-extrabold text-gray-900 mt-4 mb-2">...</h1>
                <p id="subtitulo-perfil" class="text-lg text-gray-600 italic">...</p>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="bg-white p-6 rounded-xl shadow-sm border text-center">
                    <p class="text-xs font-bold text-gray-400 uppercase">Raz√£o (QI)</p>
                    <p class="text-4xl font-black text-blue-600 mt-2"><span id="nota-qi">0</span><span class="text-lg text-gray-300">/10</span></p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border text-center">
                    <p class="text-xs font-bold text-gray-400 uppercase">Emo√ß√£o (QE)</p>
                    <p class="text-4xl font-black text-purple-600 mt-2"><span id="nota-qe">0</span><span class="text-lg text-gray-300">/10</span></p>
                </div>
            </div>

            <div class="bg-white p-8 rounded-xl shadow-sm border-l-4 border-blue-900 space-y-6">
                
                <div>
                    <h3 class="flex items-center text-lg font-bold text-gray-900 mb-2">
                        <span class="text-2xl mr-2">üëÅÔ∏è</span> O que ningu√©m v√™ em voc√™
                    </h3>
                    <p id="texto-analise" class="text-gray-600 leading-relaxed">...</p>
                </div>

                <div>
                    <h3 class="flex items-center text-lg font-bold text-gray-900 mb-2">
                        <span class="text-2xl mr-2">üöÄ</span> Seu Potencial M√°ximo
                    </h3>
                    <p id="texto-potencial" class="text-gray-600 leading-relaxed">...</p>
                </div>

                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="flex items-center text-sm font-bold text-blue-900 mb-1">
                        <span class="text-lg mr-2">‚ö°</span> Sua A√ß√£o Imediata
                    </h3>
                    <p id="texto-acao" class="text-sm text-blue-800">...</p>
                </div>
            </div>

            <div class="text-center px-8">
                <p class="serif text-xl text-gray-800 italic">‚ÄúA inova√ß√£o distingue um l√≠der de um seguidor.‚Äù</p>
            </div>

            <div class="relative bg-white border-2 border-gray-200 p-8 rounded-xl text-center shadow-lg overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-full opacity-5 pointer-events-none flex items-center justify-center">
                    <h1 class="text-9xl font-black text-gray-900">SIER</h1>
                </div>

                <div class="relative z-10">
                    <p class="text-xs font-bold tracking-[0.3em] text-gray-400 uppercase mb-4">SierComp4ny</p>
                    <h2 class="serif text-2xl font-bold text-gray-900 mb-2">Certificado de Autoconhecimento</h2>
                    <p class="text-gray-500 text-sm mb-6">Este documento certifica que o perfil foi analisado com sucesso.</p>

                    <div class="border-b-2 border-gray-300 w-2/3 mx-auto mb-6 pb-2">
                        <h1 id="nome-certificado" class="serif text-3xl md:text-4xl font-bold text-blue-900 italic capitalize">
                            Carregando Nome...
                        </h1>
                    </div>

                    <div class="flex justify-between items-end mt-8 text-xs text-gray-400">
                        <div class="text-left">
                            <p>ID: <span id="txid-display" class="font-mono text-gray-600">...</span></p>
                            <p>Data: <span id="data-cert">...</span></p>
                        </div>
                        <div class="text-right">
                            <img src="https://cdn-icons-png.flaticon.com/512/565/565684.png" class="w-12 h-auto ml-auto mb-1 opacity-50" alt="Assinatura">
                            <p class="font-bold text-gray-900">Anderson Dias</p>
                            <p>CEO & Founder SierComp4ny</p>
                        </div>
                    </div>
                </div>
            </div>

            <button onclick="window.print()" class="w-full bg-gray-900 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-black transition flex items-center justify-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                BAIXAR PDF (Salvar)
            </button>

        </div>
    </main>

    <script>
        // --- ‚ö†Ô∏è COLOQUE SUAS CHAVES AQUI NOVAMENTE ‚ö†Ô∏è ---
        const SUPABASE_URL = "https://oabcppkojfmmmqhevjpq.supabase.co"; 
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9hYmNwcGtvamZtbW1xaGV2anBxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzMTE2ODEsImV4cCI6MjA4NTg4NzY4MX0.b2OlaVmawuwC34kXhLwbJMm6hnPsO7Hng0r8_AHjwhw"; 
        // ---------------------------------------------------

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Textos Din√¢micos baseados no Perfil
        const PERFIS = {
            "Pot√™ncia Expansiva": {
                titulo: "O Vision√°rio (Pot√™ncia Expansiva)",
                sub: "Equil√≠brio raro entre Raz√£o e Emo√ß√£o.",
                analise: "Voc√™ tem a capacidade rara de processar dados frios sem perder o tato humano. Onde a maioria v√™ problemas isolados, voc√™ enxerga o sistema inteiro. Seu c√©rebro funciona como um radar que detecta oportunidades invis√≠veis para mentes comuns.",
                potencial: "Pense em Steve Jobs: ele n√£o vendia apenas computadores (L√≥gica), vendia sonhos e status (Emo√ß√£o). Voc√™ tem esse mesmo potencial de unir o √∫til ao desej√°vel.",
                acao: "Pare de fazer o operacional. Sua mente vale ouro na estrat√©gia. Delegue as tarefas repetitivas hoje mesmo."
            },
            "Executor Solit√°rio": {
                titulo: "O Estrategista (Executor Solit√°rio)",
                sub: "Alta precis√£o l√≥gica, foco implac√°vel.",
                analise: "Sua mente √© uma m√°quina de resolver problemas. Voc√™ disseca desafios complexos com frieza cir√∫rgica. Por√©m, tende a carregar o mundo nas costas porque 'ningu√©m faz t√£o bem quanto voc√™'.",
                potencial: "Seu caminho √© a lideran√ßa t√©cnica ou a consultoria de alto n√≠vel. Voc√™ enxerga a falha no plano antes de todos.",
                acao: "Treine um bra√ßo direito imediatamente. Voc√™ est√° limitando seu crescimento ao centralizar tudo."
            },
            "Conector Nato": {
                titulo: "O Diplomata (Conector Nato)",
                sub: "Intelig√™ncia social acima da m√©dia.",
                analise: "Voc√™ l√™ ambientes e pessoas como quem l√™ um livro. Sua for√ßa est√° na influ√™ncia e na venda de ideias. O desafio √© que voc√™, √†s vezes, evita conflitos necess√°rios para manter a harmonia.",
                potencial: "Grandes negociadores e l√≠deres de cultura corporativa t√™m esse perfil. Voc√™ move montanhas atrav√©s das pessoas.",
                acao: "Use ferramentas de gest√£o (CRM/Agenda). Sua carisma abre portas, mas a falta de processo pode fech√°-las."
            }
        };

        async function carregarRelatorio() {
            // Pega o TXID da URL
            const params = new URLSearchParams(window.location.search);
            const txid = params.get('txid');

            if (!txid) {
                alert("ID do relat√≥rio n√£o encontrado.");
                return;
            }

            // Busca no Banco
            const { data, error } = await supabase
                .from('leads')
                .select('*')
                .eq('txid', txid)
                .single();

            if (error || !data) {
                alert("Relat√≥rio n√£o encontrado ou pagamento pendente.");
                return;
            }

            // PREENCHE A TELA COM OS DADOS DO BANCO
            
            // 1. O Nome no Certificado (A Parte Mais Importante!)
            document.getElementById('nome-certificado').innerText = data.nome || "Visitante";
            
            // 2. Data e ID
            const dataPag = new Date(data.created_at).toLocaleDateString('pt-BR');
            document.getElementById('data-hoje').innerText = dataPag;
            document.getElementById('data-cert').innerText = dataPag;
            document.getElementById('txid-display').innerText = data.txid.substring(0, 8) + "...";

            // 3. Notas
            document.getElementById('nota-qi').innerText = data.qi_score;
            document.getElementById('nota-qe').innerText = data.qe_score;

            // 4. L√≥gica do Perfil (Recalcula com base nas notas salvas)
            let chave = "Conector Nato"; // Padr√£o
            if (data.qi_score > 6 && data.qe_score > 6) chave = "Pot√™ncia Expansiva";
            else if (data.qi_score > 6) chave = "Executor Solit√°rio";
            
            const texto = PERFIS[chave];

            document.getElementById('titulo-perfil').innerText = texto.titulo;
            document.getElementById('subtitulo-perfil').innerText = texto.sub;
            document.getElementById('texto-analise').innerText = texto.analise;
            document.getElementById('texto-potencial').innerText = texto.potencial;
            document.getElementById('texto-acao').innerText = texto.acao;

            // Mostra tudo
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('conteudo').classList.remove('hidden');
        }

        // Inicia
        carregarRelatorio();
    </script>
</body>
</html>
