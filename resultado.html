<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificado Oficial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Allura&family=Inter:wght@400;600;800&family=Playfair+Display:ital,wght@1,600&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .serif { font-family: 'Playfair Display', serif; }
        .assinatura { font-family: 'Allura', cursive; font-size: 3rem; color: #1e3a8a; transform: rotate(-2deg); }
        .marca-dagua {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 80px; color: rgba(0,0,0,0.03); font-weight: 900; white-space: nowrap; pointer-events: none; z-index: 0;
        }
        .loading-screen { position: fixed; inset: 0; background: #0f172a; z-index: 50; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen flex justify-center items-start">

    <div id="loading" class="loading-screen">
        <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-blue-500 mb-4"></div>
        <h2 id="msg-loading" class="text-xl font-bold animate-pulse">Buscando seu Certificado...</h2>
        <p id="msg-erro" class="text-red-400 mt-4 text-sm hidden"></p> </div>

    <div id="relatorio" class="hidden bg-white w-full max-w-3xl shadow-2xl rounded-lg overflow-hidden relative">
        
        <div class="bg-gray-900 text-white p-8 flex justify-between items-center relative z-10">
            <div>
                <h1 class="text-2xl font-bold tracking-widest">SIERCOMP4NY</h1>
                <p class="text-xs text-gray-400 uppercase tracking-wider">Intelligence & Growth</p>
            </div>
            <div class="text-right">
                <p class="text-[10px] opacity-75 uppercase tracking-widest">Relat√≥rio Confidencial</p>
                <p class="text-xs font-mono text-gray-400 mt-1" id="data-hoje">...</p>
            </div>
        </div>

        <div class="p-8 relative">
            <div class="marca-dagua">SIERCOMP4NY</div>

            <div class="text-center mb-10 relative z-10">
                <span class="bg-blue-100 text-blue-800 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wide">Resultado da An√°lise</span>
                <h2 id="titulo-perfil" class="text-3xl md:text-4xl font-black text-gray-900 mt-4 mb-2">...</h2>
                <p id="subtitulo-perfil" class="text-lg text-gray-500 italic serif">...</p>
            </div>

            <div class="flex justify-center gap-6 mb-10 relative z-10">
                <div class="text-center">
                    <div class="text-xs font-bold text-gray-400 uppercase mb-1">Raz√£o (QI)</div>
                    <div class="bg-gray-50 border border-blue-100 rounded-xl p-4 w-32 shadow-sm">
                        <span id="score-qi" class="text-4xl font-black text-blue-600">0</span>
                        <span class="text-gray-400 text-sm">/10</span>
                    </div>
                </div>
                <div class="text-center">
                    <div class="text-xs font-bold text-gray-400 uppercase mb-1">Emo√ß√£o (QE)</div>
                    <div class="bg-gray-50 border border-purple-100 rounded-xl p-4 w-32 shadow-sm">
                        <span id="score-qe" class="text-4xl font-black text-purple-600">0</span>
                        <span class="text-gray-400 text-sm">/10</span>
                    </div>
                </div>
            </div>

            <div class="space-y-8 relative z-10">
                <div class="flex gap-4">
                    <div class="text-2xl">üëÅÔ∏è</div>
                    <div>
                        <h3 class="font-bold text-gray-900">O que ningu√©m v√™ em voc√™</h3>
                        <p id="texto-analise" class="text-sm text-gray-600 leading-relaxed mt-1">...</p>
                    </div>
                </div>
                <div class="flex gap-4">
                    <div class="text-2xl">üöÄ</div>
                    <div>
                        <h3 class="font-bold text-gray-900">Seu Potencial M√°ximo</h3>
                        <p id="texto-potencial" class="text-sm text-gray-600 leading-relaxed mt-1">...</p>
                    </div>
                </div>
                <div class="bg-blue-50 border-l-4 border-blue-600 p-4 rounded-r-lg">
                    <h3 class="font-bold text-blue-900 text-sm mb-1">‚ö° Sua A√ß√£o Imediata</h3>
                    <p id="texto-acao" class="text-sm text-blue-800 italic">...</p>
                </div>
                <div class="text-center py-4">
                    <p class="text-lg serif italic text-gray-400">‚ÄúA inova√ß√£o distingue um l√≠der de um seguidor.‚Äù</p>
                </div>
            </div>

            <div class="mt-10 pt-8 border-t-2 border-gray-100 relative z-10">
                <div class="flex flex-col md:flex-row justify-between items-end gap-6">
                    <div>
                        <p class="font-bold text-gray-900 uppercase tracking-widest text-sm">SierComp4ny</p>
                        <p class="text-xs text-gray-400 mt-1">Certificado de Autoconhecimento</p>
                        <p class="text-xs font-mono text-gray-300 mt-1">ID: <span id="txid-display">...</span></p>
                        <h1 id="nome-cliente" class="text-2xl font-bold text-blue-900 mt-4 capitalize border-b border-gray-300 pb-1 inline-block min-w-[200px]">
                            Carregando...
                        </h1>
                    </div>
                    <div class="text-right">
                        <div class="assinatura mb-2">Anderson Dias</div>
                        <div class="h-px w-40 bg-gray-400 ml-auto mb-1"></div>
                        <p class="text-[10px] text-gray-500 font-bold uppercase tracking-wider">Criado por Anderson Dias</p>
                        <p class="text-[9px] text-gray-400 uppercase">CEO & Founder SierComp4ny</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="bg-gradient-to-r from-gray-900 to-blue-900 h-3 w-full"></div>
    </div>

    <div class="fixed bottom-6 right-6 flex flex-col gap-3 z-50">
        <button onclick="gerarPDF()" class="hidden bg-blue-600 hover:bg-blue-700 text-white font-bold p-4 rounded-full shadow-xl flex items-center justify-center transition hover:scale-105" id="btn-pdf">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
        </button>
    </div>

    <script>
        // ======================================================
        // ‚ö†Ô∏è PREENCHA AQUI OU VAI DAR TELA INFINITA ‚ö†Ô∏è
        const SUPABASE_URL = "https://oabcppkojfmmmqhevjpq.supabase.co"; 
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9hYmNwcGtvamZtbW1xaGV2anBxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzMTE2ODEsImV4cCI6MjA4NTg4NzY4MX0.b2OlaVmawuwC34kXhLwbJMm6hnPsO7Hng0r8_AHjwhw"; 
        // ======================================================

        const PERFIS = {
            "Pot√™ncia Expansiva": { titulo: "O Vision√°rio", sub: "Equil√≠brio Raz√£o e Emo√ß√£o.", analise: "Vis√£o sist√™mica rara.", potencial: "Unir o √∫til ao desej√°vel.", acao: "Delegue o operacional." },
            "Executor Solit√°rio": { titulo: "O Estrategista", sub: "Alta precis√£o l√≥gica.", analise: "Resolve problemas complexos.", potencial: "Lideran√ßa t√©cnica.", acao: "Treine um bra√ßo direito." },
            "Conector Nato": { titulo: "O Diplomata", sub: "Intelig√™ncia social.", analise: "L√™ ambientes e pessoas.", potencial: "Negocia√ß√£o e cultura.", acao: "Use CRM e processos." },
            "Em Constru√ß√£o": { titulo: "Em An√°lise", sub: "Dados insuficientes.", analise: "Refa√ßa o teste com calma.", potencial: "...", acao: "Refazer teste." }
        };

        async function init() {
            try {
                // 1. Verifica se tem chaves
                if (SUPABASE_URL.includes("COLE_SUA") || SUPABASE_KEY.includes("COLE_SUA")) {
                    throw new Error("ERRO NO C√ìDIGO: As chaves do Supabase n√£o foram configuradas no arquivo resultado.html");
                }

                // 2. Conecta
                const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                const params = new URLSearchParams(window.location.search);
                const txid = params.get('txid');

                if (!txid) throw new Error("Link incompleto: Falta o ID do pagamento.");

                // 3. Busca
                const { data, error } = await supabase.from('leads').select('*').eq('txid', txid).single();

                if (error) throw new Error("Erro ao buscar dados: " + error.message);
                if (!data) throw new Error("Pagamento n√£o encontrado no sistema.");

                // 4. Preenche
                document.getElementById('nome-cliente').innerText = data.nome || "Cliente VIP";
                document.getElementById('score-qi').innerText = data.qi_score || 0;
                document.getElementById('score-qe').innerText = data.qe_score || 0;
                document.getElementById('txid-display').innerText = txid.slice(0, 8);
                document.getElementById('data-hoje').innerText = new Date(data.created_at).toLocaleDateString('pt-BR');

                // 5. Perfil
                let p = "Conector Nato";
                if (data.qi_score > 6 && data.qe_score > 6) p = "Pot√™ncia Expansiva";
                else if (data.qi_score > 6) p = "Executor Solit√°rio";
                
                const txt = PERFIS[p] || PERFIS["Em Constru√ß√£o"];
                document.getElementById('titulo-perfil').innerText = txt.titulo;
                document.getElementById('subtitulo-perfil').innerText = txt.sub;
                document.getElementById('texto-analise').innerText = txt.analise;
                document.getElementById('texto-potencial').innerText = txt.potencial;
                document.getElementById('texto-acao').innerText = txt.acao;

                // 6. Mostra
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('relatorio').classList.remove('hidden');
                document.getElementById('btn-pdf').classList.remove('hidden');

            } catch (err) {
                document.getElementById('msg-loading').innerText = "Ops! Algo deu errado.";
                const divErro = document.getElementById('msg-erro');
                divErro.innerText = err.message;
                divErro.classList.remove('hidden');
            }
        }

        function gerarPDF() {
            const el = document.getElementById('relatorio');
            html2pdf().set({ margin:0, filename:'Certificado_Sier.pdf', image:{type:'jpeg',quality:0.98}, html2canvas:{scale:2}, jsPDF:{unit:'in',format:'letter',orientation:'portrait'} }).from(el).save();
        }

        init();
    </script>
</body>
</html>
