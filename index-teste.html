<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sier Growth - Neuro Quiz (DEBUG MODE)</title>
    <link rel="icon" href="data:,">
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: white; margin: 0; padding: 0; padding-bottom: 200px; /* Espaço pro caguete */ }
        .card-quiz { background: #0f172a; border: 1px solid #1e293b; border-radius: 24px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); width: 100%; max-width: 400px; }
        .opcao-btn { background: #1e293b; transition: 0.2s; border: 1px solid #334155; text-align: left; width: 100%; padding: 16px; border-radius: 16px; font-size: 0.9rem; font-weight: 500; margin-bottom: 12px; cursor: pointer; }
        .opcao-btn:active { background: #3b82f6; border-color: #60a5fa; transform: scale(0.97); }
        .hidden { display: none !important; }
        .barra-progresso { height: 6px; background: #1e293b; border-radius: 3px; overflow: hidden; }
        .progresso-fill { height: 100%; background: linear-gradient(to right, #3b82f6, #8b5cf6); width: 0%; transition: width 0.3s; }
        
        /* ESTILO DO CAGUETE */
        #caguete-box {
            position: fixed; bottom: 0; left: 0; right: 0;
            height: 150px; background: rgba(0,0,0,0.9);
            color: #00ff00; font-family: monospace; font-size: 10px;
            overflow-y: scroll; padding: 10px; border-top: 2px solid #ff0000;
            z-index: 9999; pointer-events: none; /* Deixa clicar através */
        }
        .log-erro { color: #ff5555; font-weight: bold; }
        .log-info { color: #00ff00; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="caguete-box">INICIANDO SISTEMA DE DIAGNÓSTICO...<br></div>

    <div class="w-full max-w-md">
        <div id="tela-inicio" class="card-quiz p-8 text-center">
            <h1 class="text-2xl font-black text-blue-500 mb-1 uppercase tracking-tighter">Sier Growth</h1>
            <p class="text-[10px] text-slate-500 uppercase tracking-[0.2em] mb-8 italic font-semibold">Intelligence Engine v2.0</p>
            
            <div class="space-y-4">
                <input type="text" id="nome-usuario" placeholder="Nome Completo" class="w-full p-4 rounded-xl bg-slate-900 border border-slate-800 focus:border-blue-500 outline-none text-sm text-white">
                <input type="email" id="email-usuario" placeholder="E-mail" class="w-full p-4 rounded-xl bg-slate-900 border border-slate-800 focus:border-blue-500 outline-none text-sm text-white">
                <input type="tel" id="whatsapp-usuario" placeholder="WhatsApp" class="w-full p-4 rounded-xl bg-slate-900 border border-slate-800 focus:border-blue-500 outline-none text-sm text-white">
                <button id="btn-iniciar" onclick="_quizApp.iniciar()" class="w-full bg-blue-600 hover:bg-blue-700 py-4 rounded-xl font-extrabold text-lg shadow-lg transition-all">Iniciar Avaliação</button>
            </div>
            
            <button onclick="limparTudo()" class="mt-8 text-[9px] text-slate-700 uppercase tracking-widest border border-slate-800 p-2 rounded hover:text-white">FORCE RESET</button>
        </div>

        <div id="tela-perguntas" class="card-quiz p-6 hidden">
            <div class="barra-progresso mb-4"><div id="barra-progresso" class="progresso-fill"></div></div>
            <div class="flex justify-between text-[10px] text-slate-500 font-bold mb-6 uppercase tracking-widest text-center">
                <span>PERGUNTA <span id="num-pergunta">1</span>/20</span>
                <span class="text-blue-500 italic">Neuro-Análise</span>
            </div>
            <h2 id="texto-pergunta" class="text-lg font-bold mb-8 leading-tight text-slate-100">...</h2>
            <div id="area-opcoes"></div>
        </div>

        <div id="tela-pagamento" class="card-quiz p-8 text-center hidden">
            <h2 class="text-2xl font-black text-green-500 mb-2 italic uppercase text-center">Análise Pronta!</h2>
            <div id="opcoes-liberacao" class="space-y-4 mt-6">
                <button onclick="_quizApp.gerarPix()" class="w-full bg-emerald-600 p-4 rounded-2xl font-black shadow-lg">PAGAR R$ 1,00 VIA PIX</button>
                <button onclick="_quizApp.verAnuncio()" class="w-full bg-slate-800 p-4 rounded-2xl font-bold text-blue-400 text-xs border border-slate-700">ASSISTIR VÍDEO (GRÁTIS)</button>
            </div>
            <div id="area-qr" class="mt-8 bg-white p-6 rounded-[32px] hidden text-center">
                <div id="qr-content" class="flex flex-col items-center"></div>
            </div>
        </div>
    </div>

    <script>
        // --- SISTEMA CAGUETE (DEBUGGER) ---
        function logCaguete(msg, tipo = 'info') {
            const box = document.getElementById('caguete-box');
            if(box) {
                const line = document.createElement('div');
                line.className = tipo === 'erro' ? 'log-erro' : 'log-info';
                line.innerHTML = `> ${msg}`;
                box.prepend(line); // Adiciona no topo
            }
            console.log(msg);
        }

        // Pega erros globais de Javascript
        window.onerror = function(message, source, lineno, colno, error) {
            logCaguete(`ERRO CRÍTICO: ${message} (Linha: ${lineno})`, 'erro');
        };

        // --- CONFIGURAÇÃO SUPABASE ---
        const _URL_BANCO = "https://oabcppkojfmmmqhevjpq.supabase.co"; 
        const _CHAVE_BANCO = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9hYmNwcGtvamZtbW1xaGV2anBxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzMTE2ODEsImV4cCI6MjA4NTg4NzY4MX0.b2OlaVmawuwC34kXhLwbJMm6hnPsO7Hng0r8_AHjwhw";
        let supabase = null;

        try {
            if(window.supabase) {
                supabase = window.supabase.createClient(_URL_BANCO, _CHAVE_BANCO);
                logCaguete("Supabase carregado com sucesso.");
            } else {
                logCaguete("ALERTA: Biblioteca Supabase não encontrada!", 'erro');
            }
        } catch(e) {
            logCaguete("ERRO AO INICIAR SUPABASE: " + e.message, 'erro');
        }

        // --- APP ORIGINAL ---
        const _quizApp = {
            dados: { nome: '', email: '', whatsapp: '', idx: 0, qi: 0, qe: 0, txid: '' },
            perguntas: [
                { q: "Qual número completa a sequência lógica: 2, 4, 8, 16...?", opts: ["32", "24", "20"], type: "QI", c: 0 },
                // ... (Mantendo a estrutura para não ficar gigante, mas no seu coloque todas as 20)
                { q: "Em uma reunião tensa, sua tendência é:", opts: ["Mediar", "Manter-se neutro", "Impor"], type: "QE", c: 0 },
                { q: "Teste Rápido (Pulei as perguntas para testar)", opts: ["Avançar"], type: "QI", c: 0 } 
            ],

            iniciar: () => {
                logCaguete("Botão Iniciar Clicado.");
                try {
                    const n = document.getElementById('nome-usuario').value;
                    const e = document.getElementById('email-usuario').value;
                    const w = document.getElementById('whatsapp-usuario').value;
                    
                    if(!n) {
                        logCaguete("Bloqueio: Nome vazio.", 'erro');
                        return alert('Por favor, digite seu nome.');
                    }
                    
                    _quizApp.dados.nome = n;
                    _quizApp.dados.email = e;
                    _quizApp.dados.whatsapp = w;
                    
                    logCaguete(`Iniciando para: ${n}`);
                    _quizApp.mostrarTela('tela-perguntas');
                    _quizApp.renderizar();
                } catch(err) {
                    logCaguete("ERRO NA FUNÇÃO INICIAR: " + err.message, 'erro');
                }
            },

            renderizar: () => {
                try {
                    // SE ACABARAM AS PERGUNTAS (Para teste rápido, deixei 3. Coloque as 20 aqui se quiser)
                    // AJUSTE ISSO PARA 20 NO CÓDIGO FINAL
                    if(_quizApp.dados.idx >= _quizApp.perguntas.length) { 
                        logCaguete("Fim das perguntas. Salvando...");
                        _quizApp.salvarBanco();
                        return;
                    }
                    
                    const q = _quizApp.perguntas[_quizApp.dados.idx];
                    document.getElementById('num-pergunta').innerText = _quizApp.dados.idx + 1;
                    document.getElementById('texto-pergunta').innerText = q.q;
                    document.getElementById('barra-progresso').style.width = ((_quizApp.dados.idx / 3) * 100) + '%'; // Ajuste aqui o total
                    
                    const div = document.getElementById('area-opcoes');
                    div.innerHTML = '';
                    q.opts.forEach((opt, i) => {
                        const b = document.createElement('button');
                        b.className = 'opcao-btn';
                        b.innerText = opt;
                        b.onclick = () => {
                            if(i === q.c) q.type === 'QI' ? _quizApp.dados.qi++ : _quizApp.dados.qe++;
                            _quizApp.dados.idx++; 
                            _quizApp.renderizar();
                        };
                        div.appendChild(b);
                    });
                } catch(err) {
                    logCaguete("ERRO RENDERIZAR: " + err.message, 'erro');
                }
            },

            salvarBanco: async () => {
                _quizApp.mostrarTela('tela-pagamento');
                const txid = 'TX-' + Math.random().toString(36).substr(2, 9).toUpperCase();
                logCaguete(`Gerando TXID: ${txid}`);
                
                if(supabase) {
                    try {
                        logCaguete("Enviando dados para o Supabase...");
                        const { error } = await supabase.from('leads').insert([{
                            nome: _quizApp.dados.nome,
                            email: _quizApp.dados.email,
                            whatsapp: _quizApp.dados.whatsapp,
                            qi_score: _quizApp.dados.qi,
                            qe_score: _quizApp.dados.qe,
                            txid: txid,
                            status: 'pendente'
                        }]);
                        
                        if(error) {
                            logCaguete("ERRO SUPABASE: " + JSON.stringify(error), 'erro');
                        } else {
                            logCaguete("SUCESSO! DADOS SALVOS NO BANCO.");
                        }
                    } catch(e) {
                        logCaguete("ERRO CRÍTICO ENVIO: " + e.message, 'erro');
                    }
                } else {
                    logCaguete("AVISO: Supabase offline. Dados não salvos no banco.", 'erro');
                }
            },

            gerarPix: () => {
                logCaguete("Gerando Pix...");
                document.getElementById('opcoes-liberacao').classList.add('hidden');
                document.getElementById('area-qr').classList.remove('hidden');
                document.getElementById('qr-content').innerHTML = `<div class="p-8 text-slate-800 font-bold animate-pulse text-xs">GERANDO PIX...</div>`;

                setTimeout(() => {
                    const d = {
                        img: "https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=PIX_TESTE",
                        code: "00020126360014BR.GOV.BCB.PIX..."
                    };
                    logCaguete("Pix Gerado e exibido.");
                    document.getElementById('qr-content').innerHTML = `
                        <img src="${d.img}" class="w-48 h-48 rounded-xl mb-4 mx-auto">
                        <textarea class="w-full text-[9px] text-slate-600 p-3 bg-slate-50 border rounded-lg mb-4 text-center" rows="2" readonly>${d.code}</textarea>
                        <button class="w-full bg-blue-600 text-white py-3 rounded-xl text-[10px] font-black uppercase text-center shadow-md">Copiar Código</button>
                    `;
                }, 1000);
            },

            verAnuncio: () => {
                window.location.href = `resultado-teste.html?txid=FREE&nome=${encodeURIComponent(_quizApp.dados.nome)}`;
            },

            mostrarTela: (id) => {
                ['tela-inicio', 'tela-perguntas', 'tela-pagamento'].forEach(t => document.getElementById(t).classList.add('hidden'));
                document.getElementById(id).classList.remove('hidden');
            }
        };

        // Função de Limpeza
        window.limparTudo = function() {
            localStorage.clear();
            logCaguete("Cache limpo. Recarregando...");
            setTimeout(() => location.reload(), 1000);
        }

        logCaguete("Sistema pronto. Aguardando input.");
    </script>
</body>
</html>
