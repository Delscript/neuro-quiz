<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neuro Quiz - Sier Growth</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: white; }
        .card-quiz { background: #0f172a; border: 1px solid #1e293b; border-radius: 24px; }
        .opcao-btn { background: #1e293b; transition: 0.2s; border: 1px solid transparent; }
        .opcao-btn:active { background: #3b82f6; border-color: #60a5fa; transform: scale(0.98); }
        .hidden { display: none; }
        .barra-progresso { height: 6px; background: #1e293b; border-radius: 3px; overflow: hidden; }
        .progresso-fill { height: 100%; background: linear-gradient(to right, #3b82f6, #8b5cf6); width: 0%; transition: width 0.3s; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-md">
        
        <div id="tela-inicio" class="card-quiz p-8 text-center">
            <h1 class="text-2xl font-black text-blue-500 mb-1">SIER GROWTH</h1>
            <p class="text-xs text-slate-500 uppercase tracking-widest mb-6 italic">Neuro-Cognitive Assessment</p>
            
            <div class="space-y-4">
                <input type="text" id="nome-usuario" placeholder="Seu Nome Completo" class="w-full p-4 rounded-xl bg-slate-900 border border-slate-800 focus:border-blue-500 outline-none text-sm">
                <input type="email" id="email-usuario" placeholder="Seu melhor e-mail" class="w-full p-4 rounded-xl bg-slate-900 border border-slate-800 focus:border-blue-500 outline-none text-sm">
                <input type="tel" id="whatsapp-usuario" placeholder="WhatsApp (com DDD)" class="w-full p-4 rounded-xl bg-slate-900 border border-slate-800 focus:border-blue-500 outline-none text-sm">
                <button onclick="_quizApp.iniciar()" class="w-full bg-blue-600 hover:bg-blue-700 py-4 rounded-xl font-extrabold text-lg shadow-lg shadow-blue-900/20">Iniciar Avalia√ß√£o</button>
            </div>
            <p class="text-[10px] text-slate-600 mt-6">¬© 2026 SierComp4ny ‚Ä¢ Anderson Dias</p>
        </div>

        <div id="tela-perguntas" class="card-quiz p-6 hidden">
            <div class="barra-progresso mb-4"><div id="barra-progresso" class="progresso-fill"></div></div>
            <div class="flex justify-between text-[10px] text-slate-500 font-bold mb-6">
                <span>QUEST√ÉO <span id="num-pergunta">1</span>/20</span>
                <span>SIER GROWTH ENGINE</span>
            </div>
            <h2 id="texto-pergunta" class="text-lg font-bold mb-8 leading-tight">...</h2>
            <div id="area-opcoes" class="space-y-3"></div>
        </div>

        <div id="tela-carregando" class="card-quiz p-10 text-center hidden">
            <div class="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
            <h2 class="text-xl font-black animate-pulse">PROCESSANDO M√âTRICAS</h2>
            <p class="text-slate-500 text-sm mt-2">Cruzando dados de QI e QE...</p>
        </div>

        <div id="tela-pagamento" class="card-quiz p-8 text-center hidden">
            <h2 class="text-2xl font-black text-green-500 mb-2">AN√ÅLISE PRONTA!</h2>
            <p class="text-slate-400 text-sm mb-8">Escolha como deseja liberar seu relat√≥rio oficial:</p>
            
            <div id="opcoes-liberacao" class="space-y-4">
                <button onclick="_quizApp.gerarPix()" class="w-full bg-emerald-600 p-4 rounded-2xl font-bold flex items-center justify-center gap-2">
                    <span>‚ö°</span> Pagar R$ 1,00 via PIX
                </button>
                <div class="text-slate-700 font-bold text-xs uppercase tracking-widest">ou</div>
                <button onclick="_quizApp.verAnuncio()" class="w-full bg-slate-800 p-4 rounded-2xl font-bold text-blue-400 text-sm border border-slate-700">
                    üì∫ Ver v√≠deo e liberar GR√ÅTIS
                </button>
            </div>

            <div id="area-qr" class="mt-8 bg-white p-4 rounded-3xl hidden">
                <div id="qr-content"></div>
                <p class="text-blue-600 font-black text-[10px] mt-4 animate-pulse uppercase tracking-widest">‚è≥ Aguardando Pagamento</p>
            </div>
        </div>
    </div>

    <script>
        const _URL_BANCO = "https://oabcppkojfmmmqhevjpq.supabase.co"; 
        const _CHAVE_BANCO = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9hYmNwcGtvamZtbW1xaGV2anBxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzMTE2ODEsImV4cCI6MjA4NTg4NzY4MX0.b2OlaVmawuwC34kXhLwbJMm6hnPsO7Hng0r8_AHjwhw";
        const supabase = window.supabase.createClient(_URL_BANCO, _CHAVE_BANCO);

        var _quizApp = {
            dados: { nome: '', email: '', whatsapp: '', qi: 0, qe: 0, idx: 0, fase: 'N√£o Informado' },
            perguntas: [
                { q: "Qual n√∫mero completa: 2, 4, 8...?", opts: ["16", "12", "10"], type: "QI", c: 0 },
                { q: "Sob press√£o extrema, voc√™:", opts: ["Foca na solu√ß√£o", "Trava", "Reclama"], type: "QE", c: 0 },
                { q: "Se A > B e B > C, ent√£o:", opts: ["A > C", "C > A", "A = C"], type: "QI", c: 0 },
                { q: "Cliente gritou. Rea√ß√£o:", opts: ["Resolve calmo", "Grita", "Chora"], type: "QE", c: 0 },
                { q: "O que pesa mais: 1kg chumbo ou algod√£o?", opts: ["Iguais", "Chumbo", "Algod√£o"], type: "QI", c: 0 },
                { q: "Complete: A, C, E, G...", opts: ["I", "H", "J"], type: "QI", c: 0 },
                { q: "Em grupo prefere:", opts: ["Liderar", "Esperar", "Fazer s√≥"], type: "QE", c: 0 },
                { q: "Erro na empresa:", opts: ["Assume", "Esconde", "Culpa outro"], type: "QE", c: 0 },
                { q: "20% de 500 √©:", opts: ["100", "50", "200"], type: "QI", c: 0 },
                { q: "Se ontem fosse amanh√£, hoje seria s√°bado. Hoje √©:", opts: ["Sexta", "Domingo", "Segunda"], type: "QI", c: 2 },
                { q: "Feedback duro:", opts: ["Cresce", "Raiva", "Desiste"], type: "QE", c: 0 },
                { q: "M√©dico : Hospital :: Professor : ?", opts: ["Escola", "Aluno", "Giz"], type: "QI", c: 0 },
                { q: "Colega triste:", opts: ["Ajuda", "Ignora", "Piada"], type: "QE", c: 0 },
                { q: "Negocia√ß√£o:", opts: ["Acordo", "Vencer", "N√£o perder"], type: "QE", c: 0 },
                { q: "Carro 80km/h em 30min:", opts: ["40km", "80km", "60km"], type: "QI", c: 0 },
                { q: "Intelig√™ncia Emocional:", opts: ["Gerir emo√ß√µes", "Nada", "Feliz"], type: "QE", c: 0 },
                { q: "N√£o pertence:", opts: ["Cadeira", "Banana", "Ma√ß√£"], type: "QI", c: 0 },
                { q: "Inovar precisa:", opts: ["Resolver dor", "Dinheiro", "Sorte"], type: "QI", c: 0 },
                { q: "Mudan√ßa repentina:", opts: ["Adapta", "Reclama", "Trava"], type: "QE", c: 0 },
                { q: "Qual sua fase profissional atual?", opts: ["Dono de Neg√≥cio", "Aut√¥nomo", "CLT", "Estudante"], type: "SEG", c: 0 }
            ],

            iniciar: () => {
                const n = document.getElementById('nome-usuario').value;
                const e = document.getElementById('email-usuario').value;
                const z = document.getElementById('whatsapp-usuario').value;
                if(!n || !e.includes('@') || !z) return alert('Por favor, preencha os dados corretamente!');
                _quizApp.dados.nome = n; _quizApp.dados.email = e; _quizApp.dados.whatsapp = z;
                _quizApp.mostrarTela('tela-perguntas');
                _quizApp.renderizar();
            },

            renderizar: () => {
                if(_quizApp.dados.idx >= _quizApp.perguntas.length) return _quizApp.finalizar();
                const q = _quizApp.perguntas[_quizApp.dados.idx];
                document.getElementById('num-pergunta').innerText = _quizApp.dados.idx + 1;
                document.getElementById('texto-pergunta').innerText = q.q;
                document.getElementById('barra-progresso').style.width = ((_quizApp.dados.idx / _quizApp.perguntas.length) * 100) + '%';
                const div = document.getElementById('area-opcoes');
                div.innerHTML = '';
                q.opts.forEach((opt, i) => {
                    const b = document.createElement('button');
                    b.className = 'opcao-btn w-full p-4 rounded-2xl text-left text-sm font-semibold';
                    b.innerText = opt;
                    b.onclick = () => {
                        if(q.type === 'SEG') _quizApp.dados.fase = opt;
                        else if(i === q.c) q.type === 'QI' ? _quizApp.dados.qi++ : _quizApp.dados.qe++;
                        _quizApp.dados.idx++; _quizApp.renderizar();
                    };
                    div.appendChild(b);
                });
            },

            finalizar: () => {
                _quizApp.mostrarTela('tela-carregando');
                setTimeout(() => _quizApp.mostrarTela('tela-pagamento'), 2500);
            },

            gerarPix: async () => {
                document.getElementById('opcoes-liberacao').classList.add('hidden');
                document.getElementById('area-qr').classList.remove('hidden');
                try {
                    const res = await fetch('/api/pix', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(_quizApp.dados)
                    });
                    const d = await res.json();
                    if(d.txid) {
                        localStorage.setItem('neuro_txid', d.txid);
                        localStorage.setItem('neuro_qr_img', d.img);
                        localStorage.setItem('neuro_qr_code', d.code);
                        _quizApp.exibirQR(d.img, d.code);
                        _quizApp.verificarPagamento(d.txid);
                    }
                } catch(e) { alert("Erro ao conectar com servidor de pagamentos."); }
            },

            exibirQR: (img, code) => {
                document.getElementById('qr-content').innerHTML = `
                    <img src="${img}" class="mx-auto w-48 rounded-lg mb-4">
                    <textarea class="w-full text-[10px] text-slate-800 p-3 bg-slate-100 rounded-xl border-none" rows="3" readonly>${code}</textarea>
                    <button onclick="navigator.clipboard.writeText('${code}');alert('Pix Copiado!')" class="w-full bg-slate-900 text-white mt-4 py-3 rounded-xl text-xs font-bold">COPIAR C√ìDIGO PIX</button>
                `;
            },

            verAnuncio: () => {
                alert("Carregando v√≠deo premiado...");
                // Aqui voc√™ integrar√° o SDK do AdMob posteriormente
                setTimeout(() => window.location.href = `resultado.html?txid=FREE_APP&nome=${encodeURIComponent(_quizApp.dados.nome)}`, 2000);
            },

            verificarPagamento: (txid) => {
                setInterval(async () => {
                    try {
                        const r = await fetch('/api/status?txid=' + txid);
                        const j = await r.json();
                        if (j.status === 'pago') {
                            localStorage.clear();
                            window.location.href = `resultado.html?txid=${txid}`;
                        }
                    } catch (e) {}
                }, 3000);
            },

            mostrarTela: (id) => {
                document.querySelectorAll('.card-quiz').forEach(el => el.classList.add('hidden'));
                document.getElementById(id).classList.remove('hidden');
            }
        };

        // RECUPERA√á√ÉO AUTOM√ÅTICA (BLINDAGEM F5)
        window.onload = () => {
            const txid = localStorage.getItem('neuro_txid');
            const img = localStorage.getItem('neuro_qr_img');
            const code = localStorage.getItem('neuro_qr_code');
            if (txid && img && code) {
                _quizApp.mostrarTela('tela-pagamento');
                document.getElementById('opcoes-liberacao').classList.add('hidden');
                document.getElementById('area-qr').classList.remove('hidden');
                _quizApp.exibirQR(img, code);
                _quizApp.verificarPagamento(txid);
            }
        };
    </script>
</body>
</html>
