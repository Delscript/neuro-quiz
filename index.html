<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avalia√ß√£o Neuro-Cognitiva</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --text: #1e293b; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 20px; text-align: center; margin: 0; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h1 { color: #0f172a; font-size: 1.8rem; }
        .btn { display: block; width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 20px; transition: 0.2s; }
        .btn:active { transform: scale(0.98); }
        input { width: 100%; padding: 15px; border: 2px solid #e2e8f0; border-radius: 12px; margin-top: 10px; box-sizing: border-box; font-size: 1rem; }
        
        /* Telas */
        .screen { display: none; animation: fadeIn 0.4s; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Quiz */
        .option { padding: 15px; border: 2px solid #f1f5f9; margin: 10px 0; border-radius: 10px; cursor: pointer; text-align: left; transition: 0.2s; font-weight: 500; }
        .option:hover { background: #eff6ff; border-color: var(--primary); }
        .bar-bg { width: 100%; background: #e2e8f0; height: 8px; border-radius: 4px; margin-bottom: 20px; }
        .bar-fill { height: 100%; background: var(--primary); width: 0%; border-radius: 4px; transition: width 0.3s; }

        /* Pix Area */
        .pix-box { background: #f8fafc; padding: 20px; border-radius: 12px; border: 2px dashed #cbd5e1; margin: 20px 0; }
        .copy-btn { background: #334155; margin-top: 10px; font-size: 0.9rem; padding: 10px; width: auto; display: inline-block; }
    </style>
</head>
<body>

<div class="container">
    
    <div id="step-lead" class="screen active">
        <h1>Avalia√ß√£o Neuro-Cognitiva</h1>
        <p>Descubra seu perfil exato de QI e QE e receba um plano de carreira.</p>
        <div style="background: #ecfdf5; padding: 10px; border-radius: 8px; font-size: 0.9rem; color: #065f46; margin-bottom: 20px;">
            üîí Teste Oficial Sier Growth
        </div>
        <input type="email" id="email" placeholder="Seu melhor e-mail...">
        <button class="btn" onclick="app.start()">Iniciar Avalia√ß√£o</button>
    </div>

    <div id="step-quiz" class="screen">
        <div class="bar-bg"><div id="progress" class="bar-fill"></div></div>
        <p style="text-align: right; font-size: 0.8rem; color: #64748b;">Pergunta <span id="q-num">1</span> de 19</p>
        <h2 id="q-text" style="min-height: 50px;">...</h2>
        <div id="q-options"></div>
    </div>

    <div id="step-loading" class="screen">
        <div style="font-size: 3rem; margin-bottom: 20px;">üß†</div>
        <h2>Processando Respostas...</h2>
        <p>Cruzando m√©tricas de l√≥gica e intelig√™ncia emocional...</p>
    </div>

    <div id="step-pay" class="screen">
        <h2 style="color: #10b981">An√°lise Conclu√≠da!</h2>
        <p>Identificamos um perfil de alto potencial, mas com travas ocultas.</p>
        
        <div style="text-align: left; background: #fff; border-left: 4px solid #2563eb; padding: 15px; margin: 20px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
            <p><strong>Seu Perfil Base:</strong> <span id="preview-perfil">Calculando...</span></p>
            <p style="filter: blur(4px); opacity: 0.5;">Sua capacidade de lideran√ßa √© not√°vel, por√©m a gest√£o de tempo...</p>
        </div>

        <h1 style="color: #2563eb; font-size: 2.5rem; margin: 10px 0;">R$ 19,90</h1>
        
        <div id="qr-area" class="pix-box">
            <p>Gerando Pix Seguro...</p>
        </div>
        
        <p style="font-size: 0.8rem; color: #64748b;">O relat√≥rio completo ser√° liberado automaticamente ap√≥s o pagamento.</p>
    </div>

    <div id="step-result" class="screen">
        <h1 style="color: #2563eb">Relat√≥rio Liberado ‚úÖ</h1>
        <div id="final-content" style="text-align: left; line-height: 1.6;"></div>
        <button class="btn" style="background: #25D366" onclick="app.openZap()">Falar com Anderson Dias</button>
    </div>

</div>

<script>
    // --- ‚öôÔ∏è √ÅREA DE CONFIGURA√á√ÉO (PREENCHA AQUI) ---
    // Coloque suas chaves do Supabase dentro das aspas abaixo
    
    const SB_URL = 'https://oabcppkojfmmmqhevjpq.supabase.co';
    const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9hYmNwcGtvamZtbW1xaGV2anBxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzMTE2ODEsImV4cCI6MjA4NTg4NzY4MX0.b2OlaVmawuwC34kXhLwbJMm6hnPsO7Hng0r8_AHjwhw';

    // ---------------------------------------------

    // Inicializa Supabase (S√≥ para salvar leads, o Pix vai pela Vercel)
    let supabase = null;
    try {
        if (SB_URL && SB_KEY) {
            supabase = window.supabase.createClient(SB_URL, SB_KEY);
        } else {
            console.warn("Chaves n√£o configuradas.");
        }
    } catch (e) { console.error(e); }

    const app = {
        data: { email: '', qi: 0, qe: 0, idx: 0, perfil: null },
        
        // AS 19 PERGUNTAS OFICIAIS
        questions: [
            { q: "Qual n√∫mero completa: 2, 4, 8...?", opts: ["16", "12", "10"], type: "QI", c: 0 },
            { q: "Sob press√£o extrema, voc√™:", opts: ["Foca na solu√ß√£o", "Trava/Entra em p√¢nico", "Reclama com a equipe"], type: "QE", c: 0 },
            { q: "Se A > B e B > C, ent√£o:", opts: ["A > C", "C > A", "A = C"], type: "QI", c: 0 },
            { q: "Cliente gritou com voc√™ injustamente. Rea√ß√£o:", opts: ["Escuta e resolve calmo", "Grita de volta", "Leva pro pessoal e chora"], type: "QE", c: 0 },
            { q: "O que pesa mais: 1kg de chumbo ou 1kg de algod√£o?", opts: ["Pesam igual", "Chumbo", "Algod√£o"], type: "QI", c: 0 },
            { q: "Complete: A, C, E, G...", opts: ["I", "H", "J"], type: "QI", c: 0 },
            { q: "Em um projeto em grupo, voc√™ prefere:", opts: ["Liderar e organizar", "Esperar ordens", "Fazer tudo sozinho"], type: "QE", c: 0 },
            { q: "Voc√™ cometeu um erro grave na empresa:", opts: ["Assume e prop√µe solu√ß√£o", "Tenta esconder", "Culpa o sistema"], type: "QE", c: 0 },
            { q: "Quanto √© 20% de 500?", opts: ["100", "50", "200"], type: "QI", c: 0 },
            { q: "Se ontem fosse amanh√£, hoje seria s√°bado. Que dia √© hoje?", opts: ["Sexta", "Domingo", "Segunda"], type: "QI", c: 2 },
            { q: "Recebeu um feedback duro do chefe:", opts: ["Usa para crescer", "Fica com raiva", "Pensa em pedir demiss√£o"], type: "QE", c: 0 },
            { q: "M√©dico est√° para Hospital como Professor est√° para:", opts: ["Escola", "Aluno", "Giz"], type: "QI", c: 0 },
            { q: "Colega est√° visivelmente triste hoje:", opts: ["Oferece ajuda discreta", "Ignora para n√£o incomodar", "Faz piada para animar"], type: "QE", c: 0 },
            { q: "Numa negocia√ß√£o dif√≠cil, o objetivo √©:", opts: ["Acordo bom para ambos", "Vencer a qualquer custo", "N√£o perder dinheiro"], type: "QE", c: 0 },
            { q: "Carro a 80km/h. Em 30min percorre:", opts: ["40km", "80km", "60km"], type: "QI", c: 0 },
            { q: "Intelig√™ncia Emocional significa:", opts: ["Gerir emo√ß√µes", "N√£o sentir nada", "Ser sempre feliz"], type: "QE", c: 0 },
            { q: "Qual item n√£o pertence ao grupo?", opts: ["Cadeira", "Banana", "Ma√ß√£"], type: "QI", c: 0 },
            { q: "Para inovar no mercado √© preciso:", opts: ["Resolver dores reais", "Ter muito dinheiro", "Sorte"], type: "QI", c: 0 },
            { q: "Mudan√ßa repentina de planos:", opts: ["Adapta-se r√°pido", "Reclama do planejamento", "Trava"], type: "QE", c: 0 }
        ],

        start: async () => {
            const email = document.getElementById('email').value.trim();
            if(!email.includes('@')) return alert('Digite um e-mail v√°lido!');
            app.data.email = email;
            
            if(supabase) await supabase.from('leads').insert([{ email: email, status_pagamento: 'aguardando' }]);
            app.show('step-quiz');
            app.renderQ();
        },

        renderQ: () => {
            if(app.data.idx >= app.questions.length) return app.finish();
            const q = app.questions[app.data.idx];
            
            document.getElementById('q-num').innerText = app.data.idx + 1;
            document.getElementById('q-text').innerText = q.q;
            document.getElementById('progress').style.width = ((app.data.idx / app.questions.length) * 100) + '%';
            
            const div = document.getElementById('q-options');
            div.innerHTML = '';
            q.opts.forEach((opt, i) => {
                const btn = document.createElement('div');
                btn.className = 'option';
                btn.innerText = opt;
                btn.onclick = () => {
                    if(i === q.c) q.type === 'QI' ? app.data.qi++ : app.data.qe++;
                    app.data.idx++;
                    app.renderQ();
                };
                div.appendChild(btn);
            });
        },

        finish: async () => {
            app.show('step-loading');
            
            // L√≥gica do Perfil
            let perfil = { nome: "Em Constru√ß√£o", texto: "Perfil em desenvolvimento." };
            if(app.data.qi > 6 && app.data.qe > 6) {
                perfil = { nome: "Pot√™ncia Expansiva", texto: "Voc√™ tem o equil√≠brio raro entre L√≥gica e Emo√ß√£o. Seu desafio agora √© Escala e Parcerias." };
            } else if(app.data.qi > 6) {
                perfil = { nome: "Executor Solit√°rio", texto: "Alta capacidade t√©cnica, mas sofre por centralizar. Precisa aprender Gest√£o e Delega√ß√£o." };
            } else if(app.data.qe > 6) {
                perfil = { nome: "Conector Nato", texto: "Excelente com pessoas e vendas, mas falta processo e m√©tricas. Precisa de Organiza√ß√£o." };
            }
            
            app.data.perfil = perfil;
            document.getElementById('preview-perfil').innerText = perfil.nome;

            if(supabase) await supabase.from('leads').update({ qi_score: app.data.qi, qe_score: app.data.qe }).eq('email', app.data.email);

            app.generatePix();
        },

        generatePix: async () => {
            // Aqui mudamos a l√≥gica para chamar a VERCEL em vez do Supabase
            try {
                // Chama seu novo rob√¥ Vercel (/api/pix.js)
                const response = await fetch('/api/pix', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: app.data.email, valor: 19.90 })
                });

                const data = await response.json();
                
                if(!response.ok) {
                    throw new Error(data.erro || 'Erro desconhecido na Vercel');
                }
                
                // Exibe o Pix com Sucesso
                document.getElementById('qr-area').innerHTML = `
                    <img src="${data.img}" style="width:200px; mix-blend-mode: multiply; display:block; margin:0 auto;">
                    <textarea style="width:100%; font-size:0.8rem; border:1px solid #ccc; padding:10px; margin-top:10px; border-radius:5px;" rows="3" readonly>${data.code}</textarea>
                    <button class="btn copy-btn" onclick="navigator.clipboard.writeText('${data.code}'); alert('C√≥digo Pix Copiado!')">Copiar C√≥digo Pix</button>
                `;
                
                app.show('step-pay');

                // Mant√©m o ouvinte de pagamento do Supabase (para liberar o relat√≥rio)
                if(supabase) {
                    supabase.channel('pgto_realtime')
                    .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'leads', filter: `email=eq.${app.data.email}` }, 
                    (payload) => {
                        if(payload.new.status_pagamento === 'pago') app.showResult();
                    }).subscribe();
                }

            } catch(e) {
                console.error(e);
                app.show('step-pay');
                document.getElementById('qr-area').innerHTML = `
                    <p style='color:red; font-weight:bold;'>Erro ao gerar Pix.</p>
                    <p style='font-size:0.8rem;'>Detalhe: ${e.message}</p>
                    <button class="btn" onclick="app.generatePix()">Tentar Novamente</button>
                `;
            }
        },

        showResult: () => {
            const p = app.data.perfil;
            document.getElementById('final-content').innerHTML = `
                <h2>${p.nome}</h2>
                <p><strong>Diagn√≥stico:</strong> ${p.texto}</p>
                <hr style="margin:20px 0; border-top:1px solid #eee;">
                <p>Seu pagamento foi confirmado! Vamos agendar sua mentoria para desbloquear o pr√≥ximo n√≠vel.</p>
            `;
            app.show('step-result');
        },

        openZap: () => window.open("https://wa.me/5571999466243", "_blank"), // Coloque seu n√∫mero aqui
        
        show: (id) => {
            document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
    };
</script>

</body>
</html>
