<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avalia√ß√£o Neuro-Cognitiva | Relat√≥rio Oficial</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #2563eb; --success: #10b981; --bg: #f8fafc; --text: #1e293b; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; line-height: 1.6; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        
        h1, h2 { text-align: center; color: #0f172a; }
        .btn { display: block; width: 100%; padding: 18px; background: var(--primary); color: white; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.2s; margin-top: 20px; text-align: center; text-decoration: none; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .btn-zap { background: #25D366; }
        
        /* Telas */
        .screen { display: none; animation: fadeIn 0.5s; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Inputs e Op√ß√µes */
        input { width: 100%; padding: 15px; border: 2px solid #e2e8f0; border-radius: 10px; margin-top: 10px; box-sizing: border-box; }
        .option { padding: 15px; border: 1px solid #e2e8f0; margin-bottom: 10px; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .option:hover { background: #eff6ff; border-color: var(--primary); }

        /* Pix Area */
        .pix-container { text-align: center; background: #f1f5f9; padding: 20px; border-radius: 12px; margin-top: 20px; }
        .qr-img { width: 200px; height: 200px; mix-blend-mode: multiply; margin: 10px auto; display: block; }
        .copy-code { word-break: break-all; font-family: monospace; font-size: 0.8rem; background: #fff; padding: 10px; border-radius: 5px; border: 1px dashed #cbd5e1; user-select: all; }

        /* Relat√≥rio */
        .report-card { border-left: 5px solid var(--primary); background: #f8fafc; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .blur-text { filter: blur(5px); user-select: none; opacity: 0.5; }
    </style>
</head>
<body>

<div class="container">
    
    <div id="step-lead" class="screen active">
        <h1>Avalia√ß√£o Neuro-Cognitiva</h1>
        <p>Descubra seu perfil exato de QI (L√≥gico) e QE (Emocional) e receba um plano de carreira personalizado.</p>
        <p style="font-size: 0.9rem; color: #64748b;">üîí Seus dados est√£o seguros.</p>
        
        <label>Seu melhor e-mail:</label>
        <input type="email" id="email" placeholder="exemplo@email.com">
        <button class="btn" onclick="app.start()">Iniciar Avalia√ß√£o</button>
    </div>

    <div id="step-quiz" class="screen">
        <div style="height: 5px; background: #e2e8f0; margin-bottom: 20px;"><div id="progress" style="height: 100%; background: var(--primary); width: 0%;"></div></div>
        <h2 id="q-text">...</h2>
        <div id="q-options"></div>
    </div>

    <div id="step-loading" class="screen" style="text-align: center; padding: 40px 0;">
        <div style="font-size: 3rem;">üß†</div>
        <h3>Analisando Padr√µes...</h3>
        <p>Cruzando dados de 19 anos de metodologia...</p>
    </div>

    <div id="step-pay" class="screen">
        <h2 style="color: var(--success)">An√°lise Conclu√≠da!</h2>
        <p>Identificamos um perfil raro nas suas respostas.</p>
        
        <div class="report-card">
            <h3>Pr√©via do Resultado:</h3>
            <p><strong>Perfil Base:</strong> <span id="preview-perfil">Calculando...</span></p>
            <div class="blur-text">
                <p>An√°lise detalhada: Seu n√≠vel de resili√™ncia indica uma forte tend√™ncia para lideran√ßa...</p>
                <p>Plano de A√ß√£o: Recomendamos a mentoria de processos.</p>
            </div>
        </div>

        <div class="pix-container">
            <p><strong>Desbloqueie seu Relat√≥rio Completo</strong></p>
            <h1 style="margin: 10px 0;">R$ 19,90</h1>
            
            <div id="qr-area">
                <p style="font-size: 0.8rem; color: #666;">Gerando Pix Seguro...</p>
            </div>
        </div>
        
        <p style="font-size: 0.8rem; text-align: center; margin-top: 15px; color: #666;">
            ‚è≥ Aguardando confirma√ß√£o... A tela atualizar√° automaticamente assim que o pagamento for compensado.
        </p>
    </div>

    <div id="step-result" class="screen">
        <h1 style="color: var(--primary)">Seu Relat√≥rio Oficial</h1>
        <div id="final-content"></div>
        <button class="btn btn-zap" id="btn-upsell" onclick="app.openZap()">Falar com Especialista</button>
        <button class="btn" style="background: #333; margin-top: 10px;" onclick="window.print()">Salvar PDF</button>
    </div>

</div>

<script>
       CONFIGURA√á√ÉO DO SISTEMA
       ========================================= */
    // Se deixar vazio, o site funciona em "Modo Offline" (Salva na mem√≥ria)
    // Insira suas chaves aqui. Se estiverem vazias, o modo offline ativa sozinho.
    const SB_URL = 'https://oabcppkojfmmmqhevjpq.supabase.co'; 
const SB_KEY =  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9hYmNwcGtvamZtbW1xaGV2anBxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzMTE2ODEsImV4cCI6MjA4NTg4NzY4MX0.b2OlaVmawuwC34kXhLwbJMm6hnPsO7Hng0r8_AHjwhw';
    // Inicializa Supabase
    const supabase = window.supabase.createClient(SB_URL, SB_KEY);

    // --- üìö BIBLIOTECA DE TEXTOS (Sua Estrat√©gia) ---
    const bibliotecaPerfis = {
        executor: {
            nome: "Executor Solit√°rio",
            texto: "<h3>O Executor Solit√°rio (QI Alto / QE Baixo)</h3><p><strong>Diagn√≥stico:</strong> Voc√™ tem uma capacidade t√©cnica invej√°vel, mas sente que carrega o mundo nas costas. Seu maior desafio hoje √© a paci√™ncia: entender que cada um tem seu tempo.</p><p><strong>Solu√ß√£o:</strong> Voc√™ precisa aprender a organizar as ideias para vender sua vis√£o, n√£o apenas execut√°-la. Sem gest√£o e intelig√™ncia emocional, voc√™ ser√° um g√™nio sobrecarregado.</p><hr><p><strong>Seu Pr√≥ximo Passo:</strong> Gest√£o e Resili√™ncia.</p>",
            msg: "Ol√° Anderson! Meu perfil deu Executor Solit√°rio. Preciso de ajuda com Gest√£o."
        },
        relacional: {
            nome: "Conector Nato",
            texto: "<h3>O Conector Nato (QI M√©dio / QE Alto)</h3><p><strong>Diagn√≥stico:</strong> Voc√™ tem facilidade em lidar com pessoas, mas falta 'ch√£o'. Sente que trabalha muito, mas v√™ pouco resultado concreto por falta de processos.</p><p><strong>Solu√ß√£o:</strong> Precisa se posicionar para criar autoridade real. Sua miss√£o agora √© implementar cronogramas organizacionais e usar ferramentas √°geis.</p><hr><p><strong>Seu Pr√≥ximo Passo:</strong> Ferramentas √Ågeis & Autoridade.</p>",
            msg: "Ol√° Anderson! Deu perfil Relacional. Preciso organizar meu neg√≥cio."
        },
        potencia: {
            nome: "Pot√™ncia Expansiva",
            texto: "<h3>A Pot√™ncia Expansiva (QI Alto / QE Alto)</h3><p><strong>Diagn√≥stico:</strong> N√£o adianta ser uma Ferrari em uma pista esburacada. Voc√™ tem o motor, mas o ambiente atual limita sua velocidade.</p><p><strong>Solu√ß√£o:</strong> Foco em fluxo e funil. √â hora de criar processos de escala e novas conex√µes estrat√©gicas com a Holding.</p><hr><p><strong>Seu Pr√≥ximo Passo:</strong> Parcerias Estrat√©gicas (SierComp4ny).</p>",
            msg: "Ol√° Anderson! Sou Pot√™ncia Pura. Quero falar sobre parcerias."
        },
        construcao: {
            nome: "Em Fase de Desbloqueio",
            texto: "<h3>Em Fase de Desbloqueio</h3><p><strong>Diagn√≥stico:</strong> Identificamos um bloqueio central. Suas cren√ßas ou medos est√£o travando seu potencial t√©cnico.</p><p><strong>Solu√ß√£o:</strong> Precisamos trabalhar a ressignifica√ß√£o de cren√ßas. Antes da t√©cnica, vem a coragem. Momento ideal para transi√ß√£o de carreira.</p><hr><p><strong>Seu Pr√≥ximo Passo:</strong> Ressignifica√ß√£o & Transi√ß√£o.</p>",
            msg: "Ol√° Anderson! Estou na fase de Desbloqueio. Preciso da sua mentoria."
        }
    };

    const app = {
        data: { email: '', qi: 0, qe: 0, qIndex: 0, perfilFinal: null },
        
        // Perguntas (Amostra - Adicione as suas 20 aqui)
        questions: [
            { t: "QI", q: "Qual n√∫mero completa: 2, 4, 8...?", opts: ["16", "12"], c: 0 },
            { t: "QE", q: "Sob press√£o intensa, voc√™...", opts: ["Foca na solu√ß√£o", "Reage com raiva"], c: 0 },
            { t: "QI", q: "Se A > B e B > C, ent√£o...", opts: ["A > C", "C > A"], c: 0 },
            { t: "QE", q: "Um cliente reclama injustamente. Voc√™...", opts: ["Escuta e resolve", "Discute de volta"], c: 0 }
        ],

        start: async () => {
            const email = document.getElementById('email').value;
            if(!email.includes('@')) return alert('E-mail inv√°lido');
            app.data.email = email;
            
            // Salva Lead
            await supabase.from('leads').insert([{ email: email, status_pagamento: 'aguardando' }]);
            
            app.show('step-quiz');
            app.renderQ();
        },

        renderQ: () => {
            const q = app.questions[app.data.qIndex];
            document.getElementById('q-text').innerText = q.q;
            document.getElementById('progress').style.width = ((app.data.qIndex / app.questions.length) * 100) + '%';
            
            const div = document.getElementById('q-options');
            div.innerHTML = '';
            q.opts.forEach((opt, idx) => {
                const btn = document.createElement('div');
                btn.className = 'option';
                btn.innerText = opt;
                btn.onclick = () => app.answer(idx, q.c, q.t);
                div.appendChild(btn);
            });
        },

        answer: (choice, correct, type) => {
            if(choice === correct) {
                if(type === 'QI') app.data.qi += 10;
                else app.data.qe += 10;
            }
            app.data.qIndex++;
            if(app.data.qIndex < app.questions.length) app.renderQ();
            else app.finish();
        },

        finish: async () => {
            app.show('step-loading');
            
            // 1. Define Perfil
            let p = bibliotecaPerfis.construcao;
            if(app.data.qi > 10 && app.data.qe > 10) p = bibliotecaPerfis.potencia;
            else if(app.data.qi > 10) p = bibliotecaPerfis.executor;
            else if(app.data.qe > 10) p = bibliotecaPerfis.relacional;
            
            app.data.perfilFinal = p;
            document.getElementById('preview-perfil').innerText = p.nome;

            // 2. Salva Notas no Banco
            await supabase.from('leads').update({ 
                qi_score: app.data.qi, 
                qe_score: app.data.qe 
            }).eq('email', app.data.email);

            // 3. Gera PIX (Chama a Edge Function)
            try {
                const { data, error } = await supabase.functions.invoke('gerar-pix', {
                    body: { email: app.data.email, valor: 19.90 }
                });

                if(error) throw error;
                
                // Renderiza QR Code
                const qrHTML = `
                    <img src="${data.img}" class="qr-img">
                    <p style="font-size:0.8rem; margin-bottom:5px">Copia e Cola:</p>
                    <div class="copy-code" onclick="navigator.clipboard.writeText('${data.code}'); alert('Copiado!')">${data.code}</div>
                    <button class="btn btn-outline" onclick="navigator.clipboard.writeText('${data.code}'); alert('Copiado!')" style="margin-top:10px; background:transparent; border:1px solid #333; color:#333">Copiar C√≥digo</button>
                `;
                document.getElementById('qr-area').innerHTML = qrHTML;

                app.show('step-pay');
                app.listenPayment();

            } catch (e) {
                alert('Erro ao gerar Pix. Tente novamente.');
                console.error(e);
            }
        },

        listenPayment: () => {
            // Escuta o banco de dados em tempo real
            supabase.channel('checar-pagamento')
            .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'leads', filter: `email=eq.${app.data.email}` }, 
            (payload) => {
                if(payload.new.status_pagamento === 'pago') {
                    app.renderFinal();
                }
            })
            .subscribe();
        },

        renderFinal: () => {
            const p = app.data.perfilFinal;
            document.getElementById('final-content').innerHTML = p.texto;
            app.show('step-result');
        },

        openZap: () => {
            const p = app.data.perfilFinal;
            const zap = "5571999999999"; // SEU N√öMERO AQUI
            window.open(`https://wa.me/${zap}?text=${encodeURIComponent(p.msg)}`, '_blank');
        },

        show: (id) => {
            document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
    };
</script>

</body>
</html>
