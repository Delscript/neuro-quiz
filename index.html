<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avalia√ß√£o Neuro-Cognitiva | Relat√≥rio Oficial</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #2563eb; --success: #10b981; --bg: #f8fafc; --text: #1e293b; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; line-height: 1.6; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        
        h1, h2 { text-align: center; color: #0f172a; }
        .btn { display: block; width: 100%; padding: 18px; background: var(--primary); color: white; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.2s; margin-top: 20px; text-align: center; text-decoration: none; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .btn-zap { background: #25D366; }
        
        /* Telas */
        .screen { display: none; animation: fadeIn 0.5s; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Inputs e Op√ß√µes */
        input { width: 100%; padding: 15px; border: 2px solid #e2e8f0; border-radius: 10px; margin-top: 10px; box-sizing: border-box; }
        .option { padding: 15px; border: 1px solid #e2e8f0; margin-bottom: 10px; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .option:hover { background: #eff6ff; border-color: var(--primary); }

        /* Pix Area */
        .pix-container { text-align: center; background: #f1f5f9; padding: 20px; border-radius: 12px; margin-top: 20px; }
        .qr-img { width: 200px; height: 200px; mix-blend-mode: multiply; margin: 10px auto; display: block; }
        .copy-code { word-break: break-all; font-family: monospace; font-size: 0.8rem; background: #fff; padding: 10px; border-radius: 5px; border: 1px dashed #cbd5e1; user-select: all; }

        /* Relat√≥rio */
        .report-card { border-left: 5px solid var(--primary); background: #f8fafc; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .blur-text { filter: blur(5px); user-select: none; opacity: 0.5; }
        .progress-bar { height: 5px; background: #e2e8f0; margin-bottom: 20px; border-radius: 5px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }
    </style>
</head>
<body>

<div class="container">
    
    <div id="step-lead" class="screen active">
        <h1>Avalia√ß√£o Neuro-Cognitiva</h1>
        <p>Descubra seu perfil exato de QI (L√≥gico) e QE (Emocional) em 19 perguntas estrat√©gicas.</p>
        <p style="font-size: 0.9rem; color: #64748b;">üîí Seus dados est√£o seguros.</p>
        
        <label>Seu melhor e-mail:</label>
        <input type="email" id="email" placeholder="exemplo@email.com">
        <button class="btn" onclick="app.start()">Iniciar Avalia√ß√£o</button>
    </div>

    <div id="step-quiz" class="screen">
        <div class="progress-bar"><div id="progress" class="progress-fill"></div></div>
        <p style="text-align: right; font-size: 0.8rem; color: #999;">Pergunta <span id="q-num">1</span> de 19</p>
        <h2 id="q-text" style="font-size: 1.2rem; min-height: 60px;">...</h2>
        <div id="q-options"></div>
    </div>

    <div id="step-loading" class="screen" style="text-align: center; padding: 40px 0;">
        <div style="font-size: 3rem;">üß†</div>
        <h3>Processando Dados...</h3>
        <p>Cruzando m√©tricas de l√≥gica e intelig√™ncia emocional...</p>
    </div>

    <div id="step-pay" class="screen">
        <h2 style="color: var(--success)">An√°lise Conclu√≠da!</h2>
        <p>Identificamos um padr√£o comportamental √∫nico nas suas respostas.</p>
        
        <div class="report-card">
            <h3>Pr√©via do Resultado:</h3>
            <p><strong>Perfil Base:</strong> <span id="preview-perfil" style="font-weight: bold;">Calculando...</span></p>
            <div class="blur-text">
                <p>An√°lise detalhada: Seu n√≠vel de resili√™ncia indica uma forte tend√™ncia para lideran√ßa...</p>
                <p>Plano de A√ß√£o: Recomendamos a mentoria de processos e gest√£o de tempo.</p>
                <p>Pontua√ß√£o QI: 115 | Pontua√ß√£o QE: 98</p>
            </div>
        </div>

        <div class="pix-container">
            <p><strong>Desbloqueie seu Relat√≥rio Completo + Plano de A√ß√£o</strong></p>
            <h1 style="margin: 10px 0; color: var(--primary);">R$ 19,90</h1>
            
            <div id="qr-area">
                <p style="font-size: 0.8rem; color: #666;">Gerando Pix Seguro...</p>
            </div>
        </div>
        
        <p style="font-size: 0.8rem; text-align: center; margin-top: 15px; color: #666;">
            ‚è≥ O sistema liberar√° o relat√≥rio automaticamente ap√≥s o pagamento.
        </p>
    </div>

    <div id="step-result" class="screen">
        <h1 style="color: var(--primary)">Seu Relat√≥rio Oficial</h1>
        <div id="final-content"></div>
        <button class="btn btn-zap" id="btn-upsell" onclick="app.openZap()">Falar com Anderson Dias</button>
        <button class="btn" style="background: #333; margin-top: 10px;" onclick="window.print()">Salvar PDF</button>
    </div>

</div>

<script>
    // --- ‚öôÔ∏è CONFIGURA√á√ÉO (ATEN√á√ÉO AQUI) ---
    // Coloque SUAS chaves dentro das aspas abaixo.
    // N√ÉO apague as aspas '' e N√ÉO escreva nada antes.
    
    const SB_URL = 'https://oabcppkojfmmmqhevjpq.supabase.co'; // Cole a URL do Supabase aqui (Ex: 'https://xxx.supabase.co')
    const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9hYmNwcGtvamZtbW1xaGV2anBxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzMTE2ODEsImV4cCI6MjA4NTg4NzY4MX0.b2OlaVmawuwC34kXhLwbJMm6hnPsO7Hng0r8_AHjwhw'; // Cole a chave ANON Key aqui (Ex: 'eyJhbGciOi...')
    
    // ----------------------------------------
    
// --- INICIALIZA√á√ÉO CORRIGIDA ---
    
    // 1. Criamos a vari√°vel vazia
    let supabase = null;

    try {
        // 2. O "IF" (SE) que estava faltando:
        if (SB_URL && SB_KEY) {
            // Se as chaves existem, conecta no banco
            supabase = window.supabase.createClient(SB_URL, SB_KEY);
        } else {
            // Sen√£o, avisa que faltou
            console.warn("Chaves do Supabase n√£o configuradas.");
        }
    } catch (err) {
        console.error("Erro ao iniciar Supabase:", err);
    }
    // --- üìö BIBLIOTECA DE TEXTOS E PERFIS ---
    const bibliotecaPerfis = {
        executor: {
            nome: "Executor Solit√°rio",
            texto: "<h3>O Executor Solit√°rio (QI Alto / QE Baixo)</h3><p><strong>Diagn√≥stico:</strong> Voc√™ tem uma capacidade t√©cnica invej√°vel, mas sente que carrega o mundo nas costas. Seu maior desafio hoje √© a paci√™ncia: entender que cada um tem seu tempo.</p><p><strong>Solu√ß√£o:</strong> Voc√™ precisa aprender a organizar as ideias para vender sua vis√£o, n√£o apenas execut√°-la. Sem gest√£o e intelig√™ncia emocional, voc√™ ser√° um g√™nio sobrecarregado.</p><hr><p><strong>Seu Pr√≥ximo Passo:</strong> Gest√£o e Resili√™ncia na Sier Growth.</p>",
            msg: "Ol√° Anderson! Meu perfil deu Executor Solit√°rio. Preciso de ajuda com Gest√£o."
        },
        relacional: {
            nome: "Conector Nato",
            texto: "<h3>O Conector Nato (QI M√©dio / QE Alto)</h3><p><strong>Diagn√≥stico:</strong> Voc√™ tem facilidade em lidar com pessoas, mas falta 'ch√£o'. Sente que trabalha muito, mas v√™ pouco resultado concreto por falta de processos.</p><p><strong>Solu√ß√£o:</strong> Precisa se posicionar para criar autoridade real. Sua miss√£o agora √© implementar cronogramas organizacionais e usar ferramentas √°geis.</p><hr><p><strong>Seu Pr√≥ximo Passo:</strong> Ferramentas √Ågeis & Autoridade.</p>",
            msg: "Ol√° Anderson! Deu perfil Relacional. Preciso organizar meu neg√≥cio."
        },
        potencia: {
            nome: "Pot√™ncia Expansiva",
            texto: "<h3>A Pot√™ncia Expansiva (QI Alto / QE Alto)</h3><p><strong>Diagn√≥stico:</strong> 'N√£o adianta ser uma Ferrari em uma pista esburacada'. Voc√™ tem o motor, mas o ambiente atual limita sua velocidade m√°xima.</p><p><strong>Solu√ß√£o:</strong> Foco em fluxo e funil. √â hora de criar processos de escala e novas conex√µes estrat√©gicas com a Holding SierComp4ny.</p><hr><p><strong>Seu Pr√≥ximo Passo:</strong> Parcerias Estrat√©gicas.</p>",
            msg: "Ol√° Anderson! Sou Pot√™ncia Pura. Quero falar sobre parcerias."
        },
        construcao: {
            nome: "Em Fase de Desbloqueio",
            texto: "<h3>Em Fase de Desbloqueio</h3><p><strong>Diagn√≥stico:</strong> Identificamos um bloqueio central. Suas cren√ßas ou medos est√£o travando seu potencial t√©cnico.</p><p><strong>Solu√ß√£o:</strong> Precisamos trabalhar a ressignifica√ß√£o de cren√ßas. Antes da t√©cnica, vem a coragem. Momento ideal para transi√ß√£o de carreira segura.</p><hr><p><strong>Seu Pr√≥ximo Passo:</strong> Mentoria de Carreira e Desbloqueio.</p>",
            msg: "Ol√° Anderson! Estou na fase de Desbloqueio. Preciso da sua mentoria."
        }
    };

    const app = {
        data: { email: '', qi: 0, qe: 0, qIndex: 0, perfilFinal: null },
        
        // --- AS 19 PERGUNTAS (MISTAS: L√≥gica e Emocional) ---
        questions: [
            // BLOCO 1: L√ìGICA (QI)
            { t: "QI", q: "1. Qual n√∫mero completa a sequ√™ncia: 2, 4, 8, 16...?", opts: ["24", "32", "18"], c: 1 },
            { t: "QI", q: "2. Se alguns Smurfs s√£o azuis e tudo que √© azul √© pequeno, ent√£o:", opts: ["Alguns Smurfs s√£o pequenos", "Tudo que √© pequeno √© Smurf", "Nenhum Smurf √© pequeno"], c: 0 },
            { t: "QI", q: "3. Qual item n√£o pertence ao grupo?", opts: ["Martelo", "Chave de fenda", "Banana", "Alicate"], c: 2 },
            { t: "QI", q: "4. Quanto √© 20% de 500?", opts: ["50", "100", "150"], c: 1 },
            { t: "QI", q: "5. Se ontem fosse amanh√£, hoje seria sexta-feira. Que dia √© hoje?", opts: ["S√°bado", "Domingo", "Quarta-feira"], c: 1 },
            { t: "QI", q: "6. M√©dico est√° para Hospital assim como Professor est√° para:", opts: ["Aluno", "Livro", "Escola"], c: 2 },
            { t: "QI", q: "7. O que pesa mais: 1kg de chumbo ou 1kg de algod√£o?", opts: ["Chumbo", "Algod√£o", "Iguais"], c: 2 },
            { t: "QI", q: "8. Complete: A Z B Y C ...", opts: ["D", "X", "W"], c: 1 },
            { t: "QI", q: "9. Um carro viaja a 60km/h. Em quanto tempo percorre 180km?", opts: ["2 horas", "3 horas", "4 horas"], c: 1 },
            
            // BLOCO 2: EMOCIONAL (QE) - Sem resposta certa/errada fixa, pontuamos a mais equilibrada
            { t: "QE", q: "10. Um cliente critica seu trabalho de forma agressiva. Voc√™:", opts: ["Critica ele de volta", "Ouve e busca entender a dor dele", "Ignora e vai embora"], c: 1 },
            { t: "QE", q: "11. Um colega de equipe errou feio. Sua rea√ß√£o:", opts: ["Aponta o erro na frente de todos", "Chama no particular para orientar", "Faz o trabalho por ele calado"], c: 1 },
            { t: "QE", q: "12. Voc√™ est√° sob press√£o extrema de prazo. O que sente?", opts: ["P√¢nico e paralisia", "Foco total na a√ß√£o", "Raiva do chefe"], c: 1 },
            { t: "QE", q: "13. Algu√©m fura a fila na sua frente. Voc√™:", opts: ["Arma um barraco", "Respira fundo e avalia se vale a pena falar", "Fica remoendo por dentro"], c: 1 },
            { t: "QE", q: "14. Voc√™ percebe um amigo triste. O que faz?", opts: ["Pergunta se ele quer conversar", "Tenta anim√°-lo √† for√ßa", "Finge que n√£o viu para n√£o incomodar"], c: 0 },
            { t: "QE", q: "15. Em uma negocia√ß√£o, o mais importante √©:", opts: ["Vencer a qualquer custo", "Chegar a um acordo bom para ambos", "N√£o perder dinheiro"], c: 1 },
            { t: "QE", q: "16. Quando recebe um feedback negativo, voc√™:", opts: ["Se defende imediatamente", "Agradece e reflete sobre a verdade", "Fica triste e desmotivado"], c: 1 },
            { t: "QE", q: "17. Para liderar um time, √© preciso principalmente:", opts: ["Ser temido", "Ser exemplo e servidor", "Ser o mais inteligente"], c: 1 },
            { t: "QE", q: "18. Diante de uma mudan√ßa repentina no projeto:", opts: ["Reclama que estava tudo pronto", "Se adapta r√°pido ao novo cen√°rio", "Espera algu√©m dizer o que fazer"], c: 1 },
            { t: "QE", q: "19. Voc√™ cometeu um erro grave. O que faz?", opts: ["Tenta esconder", "Culpa o sistema", "Assume e prop√µe a solu√ß√£o"], c: 2 }
        ],

        start: async () => {
            const email = document.getElementById('email').value;
            if(!email.includes('@')) return alert('Por favor, digite um e-mail v√°lido.');
            app.data.email = email;
            
            // Tenta salvar Lead (se supabase estiver configurado)
            if(supabase) {
                try {
                    await supabase.from('leads').insert([{ email: email, status_pagamento: 'aguardando' }]);
                } catch(e) { console.log("Modo offline ou erro de config"); }
            }
            
            app.show('step-quiz');
            app.renderQ();
        },

        renderQ: () => {
            const q = app.questions[app.data.qIndex];
            document.getElementById('q-num').innerText = app.data.qIndex + 1;
            document.getElementById('q-text').innerText = q.q;
            document.getElementById('progress').style.width = ((app.data.qIndex / app.questions.length) * 100) + '%';
            
            const div = document.getElementById('q-options');
            div.innerHTML = '';
            q.opts.forEach((opt, idx) => {
                const btn = document.createElement('div');
                btn.className = 'option';
                btn.innerText = opt;
                btn.onclick = () => app.answer(idx, q.c, q.t);
                div.appendChild(btn);
            });
        },

        answer: (choice, correct, type) => {
            // L√≥gica de Pontua√ß√£o
            if(choice === correct) {
                if(type === 'QI') app.data.qi += 11; // ~100 pts total
                else app.data.qe += 10; // ~100 pts total
            }
            
            app.data.qIndex++;
            if(app.data.qIndex < app.questions.length) {
                app.renderQ();
            } else {
                app.finish();
            }
        },

        finish: async () => {
            app.show('step-loading');
            
            // 1. Define Perfil (Algoritmo do Lego)
            let p = bibliotecaPerfis.construcao;
            const qi = app.data.qi;
            const qe = app.data.qe;

            if(qi > 60 && qe > 60) p = bibliotecaPerfis.potencia; // Alto QI e QE
            else if(qi > 60) p = bibliotecaPerfis.executor;       // Alto QI, Baixo QE
            else if(qe > 60) p = bibliotecaPerfis.relacional;     // Baixo QI, Alto QE
            // Se nenhum, fica em 'construcao'
            
            app.data.perfilFinal = p;
            document.getElementById('preview-perfil').innerText = p.nome;

            // 2. Salva Notas no Banco
            if(supabase) {
                try {
                    await supabase.from('leads').update({ 
                        qi_score: qi, 
                        qe_score: qe 
                    }).eq('email', app.data.email);

                    // 3. Gera PIX (Chama a Edge Function)
                    const { data, error } = await supabase.functions.invoke('gerar-pix', {
                        body: { email: app.data.email, valor: 19.90 }
                    });

                    if(error) throw error;
                    if(!data || !data.img) throw new Error("Dados do Pix incompletos");
                    
                    // Renderiza QR Code
                    const qrHTML = `
                        <img src="${data.img}" class="qr-img">
                        <p style="font-size:0.8rem; margin-bottom:5px">C√≥digo Copia e Cola:</p>
                        <div class="copy-code" onclick="navigator.clipboard.writeText('${data.code}'); alert('Copiado!')">${data.code}</div>
                        <button class="btn btn-outline" onclick="navigator.clipboard.writeText('${data.code}'); alert('Copiado!')" style="margin-top:10px; background:transparent; border:1px solid #333; color:#333; padding: 10px;">Copiar C√≥digo</button>
                    `;
                    document.getElementById('qr-area').innerHTML = qrHTML;
                    document.getElementById('step-pay').dataset.txid = data.txid; // Guarda ID para uso futuro se precisar

                    app.listenPayment(); // Come√ßa a ouvir o pagamento

                } catch (e) {
                    console.error(e);
                    document.getElementById('qr-area').innerHTML = "<p style='color:red'>Erro ao gerar Pix. Verifique se o site est√° online (https).</p>";
                }
            } else {
                // Modo Teste sem chaves
                alert("Modo Demonstra√ß√£o (Sem Supabase). O relat√≥rio ser√° exibido direto.");
                app.renderFinal();
                return;
            }

            app.show('step-pay');
        },

        listenPayment: () => {
            // Escuta o banco de dados em tempo real
            if(!supabase) return;
            
            console.log("Aguardando pagamento para: " + app.data.email);
            supabase.channel('checar-pagamento')
            .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'leads', filter: `email=eq.${app.data.email}` }, 
            (payload) => {
                if(payload.new.status_pagamento === 'pago') {
                    app.renderFinal();
                }
            })
            .subscribe();
        },

        renderFinal: () => {
            const p = app.data.perfilFinal;
            document.getElementById('final-content').innerHTML = p.texto;
            app.show('step-result');
        },

        openZap: () => {
            const p = app.data.perfilFinal;
            // Substitua pelo seu n√∫mero REAL abaixo
            const zap = "5511999999999"; 
            window.open(`https://wa.me/${zap}?text=${encodeURIComponent(p.msg)}`, '_blank');
        },

        show: (id) => {
            document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
    };
</script>

</body>
</html>
