<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relat√≥rio Oficial - SierComp4ny</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Allura&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: white; margin: 0; padding: 0; }
        .assinatura { font-family: 'Allura', cursive; font-size: 3rem; color: #60a5fa; line-height: 1; }
        
        /* Layout de exibi√ß√£o na tela do celular */
        #relatorio {
            background-color: #020617;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            padding: 30px;
            box-sizing: border-box;
        }

        .no-print { display: flex; justify-content: center; margin: 20px 0; }
    </style>
</head>
<body>

    <div id="relatorio">
        <div class="flex justify-between items-start border-b border-slate-800 pb-6 mb-8">
            <div>
                <h1 class="text-2xl font-black tracking-widest text-blue-500">SIERCOMP4NY</h1>
                <p class="text-[10px] text-slate-500 uppercase tracking-widest mt-1">
                    Intelligence & <span class="text-orange-500 font-bold">Sier Growth</span>
                </p>
            </div>
            <div class="text-right">
                <p class="text-[9px] opacity-60 uppercase tracking-widest">Confidencial</p>
                <p id="data-hoje" class="text-[10px] font-mono text-slate-400">--/--/----</p>
            </div>
        </div>

        <div class="text-center mb-10">
            <h2 id="titulo-perfil" class="text-3xl font-black text-white uppercase tracking-tighter">---</h2>
            <p id="subtitulo-perfil" class="text-blue-400 italic text-base">---</p>
        </div>

        <div class="flex justify-center gap-6 mb-10">
            <div class="bg-slate-900 border border-slate-800 p-5 rounded-3xl text-center w-28">
                <p class="text-[9px] text-slate-500 uppercase font-bold mb-1">QI</p>
                <div class="text-3xl font-black text-blue-500"><span id="score-qi">0</span><span class="text-xs text-slate-700">/10</span></div>
            </div>
            <div class="bg-slate-900 border border-slate-800 p-5 rounded-3xl text-center w-28">
                <p class="text-[9px] text-slate-500 uppercase font-bold mb-1">QE</p>
                <div class="text-3xl font-black text-purple-500"><span id="score-qe">0</span><span class="text-xs text-slate-700">/10</span></div>
            </div>
        </div>

        <div class="space-y-6 mb-12">
            <div class="bg-slate-900/50 p-4 rounded-2xl border border-slate-800">
                <h3 class="font-bold text-xs text-blue-400 uppercase mb-2">üëÅÔ∏è O que ningu√©m v√™ em voc√™</h3>
                <p id="texto-analise" class="text-[11px] text-slate-400 leading-relaxed text-justify">---</p>
            </div>
            <div class="bg-slate-900/50 p-4 rounded-2xl border border-slate-800">
                <h3 class="font-bold text-xs text-purple-400 uppercase mb-2">üöÄ Seu Potencial M√°ximo</h3>
                <p id="texto-potencial" class="text-[11px] text-slate-400 leading-relaxed text-justify">---</p>
            </div>
            <div class="bg-blue-900/20 border-l-4 border-orange-500 p-4 rounded-r-xl">
                <h3 class="font-bold text-blue-400 text-[10px] uppercase mb-1 italic">‚ö° Sua A√ß√£o Imediata</h3>
                <p id="texto-acao" class="text-[11px] text-blue-100">---</p>
            </div>
        </div>

        <div class="mt-10 pt-8 border-t border-slate-800 text-center">
            <h4 id="nome-cliente" class="text-2xl font-bold text-white mb-6 capitalize">---</h4>
            <div class="flex flex-col items-center">
                <div class="assinatura">Anderson Dias</div>
                <div class="h-px w-32 bg-slate-700 my-2"></div>
                <p class="text-[8px] text-slate-500 uppercase tracking-widest">Sier Growth ‚Ä¢ Anderson Dias</p>
                <p class="text-[8px] font-mono text-slate-800 mt-1">ID: <span id="txid-display">---</span></p>
            </div>
        </div>
    </div>

    <div class="no-print">
        <button onclick="gerarPDF()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-10 rounded-full shadow-2xl transition-all active:scale-95">
            üì• BAIXAR PDF (A4 VERTICAL)
        </button>
    </div>

    <script>
        const SUPABASE_URL = "https://oabcppkojfmmmqhevjpq.supabase.co"; 
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9hYmNwcGtvamZtbW1xaGV2anBxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzMTE2ODEsImV4cCI6MjA4NTg4NzY4MX0.b2OlaVmawuwC34kXhLwbJMm6hnPsO7Hng0r8_AHjwhw"; 
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const PERFIS = {
            "Pot√™ncia Expansiva": { titulo: "O Vision√°rio", sub: "Mestre em Estrat√©gia H√≠brida", analise: "Voc√™ processa dados frios sem perder o tato humano. Onde a maioria v√™ problemas, voc√™ enxerga o sistema inteiro.", potencial: "Pense em Steve Jobs: ele vendia sonhos e status, n√£o apenas m√°quinas.", acao: "Sua mente vale ouro na estrat√©gia. Delegue o operacional agora." },
            "Executor Solit√°rio": { titulo: "O Estrategista", sub: "Alta Performance L√≥gica", analise: "Sua mente √© uma m√°quina de resolver problemas com frieza cir√∫rgica.", potencial: "Lideran√ßa t√©cnica ou consultoria de alto n√≠vel.", acao: "Treine um bra√ßo direito imediatamente. N√£o centralize tudo." },
            "Conector Nato": { titulo: "O Diplomata", sub: "Intelig√™ncia Social Superior", analise: "Voc√™ l√™ ambientes e pessoas com facilidade extrema. Sua for√ßa √© a influ√™ncia.", potencial: "Negocia√ß√£o estrat√©gica e lideran√ßa de cultura corporativa.", acao: "Use ferramentas de gest√£o. O carisma abre portas, a disciplina as mant√©m abertas." },
            "Em Constru√ß√£o": { titulo: "Explorador", sub: "Fase de Recalibragem", analise: "Sua intelig√™ncia detectou inconsist√™ncias produtivas. Voc√™ est√° absorvendo novos conhecimentos.", potencial: "Vasto, mas exige foco em autoconhecimento.", acao: "Tente novamente focado na sua dor principal. N√£o se disperse." }
        };

        async function init() {
            const txid = new URLSearchParams(window.location.search).get('txid');
            if (!txid) return;
            const { data } = await supabase.from('leads').select('*').eq('txid', txid).single();
            if (data) {
                document.getElementById('nome-cliente').innerText = data.nome;
                document.getElementById('score-qi').innerText = data.qi_score || 0;
                document.getElementById('score-qe').innerText = data.qe_score || 0;
                document.getElementById('txid-display').innerText = txid.slice(0, 8).toUpperCase();
                document.getElementById('data-hoje').innerText = new Date().toLocaleDateString('pt-BR');
                const qi = data.qi_score || 0, qe = data.qe_score || 0;
                let p = (qi > 6 && qe > 6) ? "Pot√™ncia Expansiva" : (qi > 6) ? "Executor Solit√°rio" : (qe > 6) ? "Conector Nato" : "Em Constru√ß√£o";
                const txt = PERFIS[p];
                document.getElementById('titulo-perfil').innerText = txt.titulo;
                document.getElementById('subtitulo-perfil').innerText = txt.sub;
                document.getElementById('texto-analise').innerText = txt.analise;
                document.getElementById('texto-potencial').innerText = txt.potencial;
                document.getElementById('texto-acao').innerText = txt.acao;
            }
        }

        // FUN√á√ÉO DE GERAR PDF (A4 PORTRAIT)
        function gerarPDF(){
            const elemento = document.getElementById("relatorio");
            const clone = elemento.cloneNode(true);

            // CONFIGURA√á√ÉO DO CLONE PARA A4 (210mm x 297mm)
            clone.style.width = "210mm";
            clone.style.height = "297mm";
            clone.style.maxWidth = "none";
            clone.style.margin = "0";
            clone.style.padding = "20mm"; // Margem interna do papel
            clone.style.position = "fixed";
            clone.style.top = "0";
            clone.style.left = "0";
            clone.style.background = "#020617";
            clone.style.zIndex = "-9999";
            clone.style.display = "block";

            document.body.appendChild(clone);

            const opt = {
                margin: 0,
                filename: "Relatorio_SierComp4ny.pdf",
                image: { type: "jpeg", quality: 1 },
                html2canvas: {
                    scale: 3, // Alta defini√ß√£o
                    useCORS: true,
                    backgroundColor: "#020617",
                    windowWidth: 794, // 210mm em pixels
                    windowHeight: 1123 // 297mm em pixels
                },
                jsPDF: {
                    unit: "mm",
                    format: "a4",
                    orientation: "portrait",
                    compress: true
                }
            };

            html2pdf().set(opt).from(clone).save().then(() => {
                document.body.removeChild(clone);
            });
        }

        init();
    </script>
</body>
</html>
