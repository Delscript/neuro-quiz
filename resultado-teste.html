<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RelatÃ³rio Oficial - SierComp4ny</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Allura&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: white; margin: 0; padding: 0; }
        .assinatura { font-family: 'Allura', cursive; font-size: 1.8rem; color: #60a5fa; }
        #area-relatorio { background-color: #020617 !important; width: 100%; max-width: 600px; margin: 0 auto; }
        .no-print { display: flex; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4">

    <div id="area-relatorio" class="p-6 rounded-3xl border border-slate-800 shadow-2xl relative">
        <!-- conteÃºdo preservado -->
        ...
    </div>

    <div class="mt-8 mb-10 no-print">
        <button onclick="baixarRelatorio()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-10 rounded-full shadow-2xl flex items-center gap-2 transition-all active:scale-95">
            ðŸ“¥ BAIXAR RELATÃ“RIO COMPLETO
        </button>
    </div>

    <script>
        const SUPABASE_URL = "https://oabcppkojfmmmqhevjpq.supabase.co"; 
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9hYmNwcGtvamZtbW1xaGV2anBxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzMTE2ODEsImV4cCI6MjA4NTg4NzY4MX0.b2OlaVmawuwC34kXhLwbJMm6hnPsO7Hng0r8_AHjwhw"; 

        const PERFIS = {
            "PotÃªncia Expansiva": { titulo: "O VisionÃ¡rio", sub: "EquilÃ­brio entre RazÃ£o e EmoÃ§Ã£o", analise: "VocÃª processa dados frios sem perder o tato humano. Onde outros veem problemas, vocÃª enxerga o sistema inteiro.", potencial: "LideranÃ§a estratÃ©gica e inovaÃ§Ã£o disruptiva.", acao: "Delegue o operacional. Sua mente vale ouro na estratÃ©gia pura." },
            "Executor SolitÃ¡rio": { titulo: "O Estrategista", sub: "Alta PrecisÃ£o LÃ³gica", analise: "Sua mente Ã© uma mÃ¡quina de resolver problemas. VocÃª disseca desafios complexos com frieza cirÃºrgica.", potencial: "Consultoria de alto nÃ­vel e arquitetura tÃ©cnica.", acao: "Treine um braÃ§o direito. VocÃª estÃ¡ limitando seu crescimento ao centralizar tudo." },
            "Conector Nato": { titulo: "O Diplomata", sub: "InteligÃªncia Social Superior", analise: "VocÃª lÃª pessoas como livros. Sua forÃ§a estÃ¡ na influÃªncia e na venda de grandes ideias.", potencial: "NegociaÃ§Ã£o estratÃ©gica e cultura corporativa.", acao: "Use processos rÃ­gidos. Seu carisma abre portas, mas a disciplina as mantÃ©m abertas." },
            "Em ConstruÃ§Ã£o": { titulo: "Explorador", sub: "Fase de TransiÃ§Ã£o", analise: "Sua inteligÃªncia detectou inconsistÃªncias produtivas. VocÃª estÃ¡ em um momento de recalibragem interna.", potencial: "Vasto, mas exige foco em autoconhecimento.", acao: "Tente novamente com foco total na sua dor principal hoje." }
        };

        async function init() {
            try {
                const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                const params = new URLSearchParams(window.location.search);
                const txid = params.get('txid');

                if (!txid) return;

                const { data } = await supabase.from('leads').select('*').eq('txid', txid).single();

                if (data) {

                    document.getElementById('nome-cliente').innerText = data.nome;
                    document.getElementById('score-qi').innerText = data.qi_score || 0;
                    document.getElementById('score-qe').innerText = data.qe_score || 0;
                    document.getElementById('txid-display').innerText = txid.slice(0, 8).toUpperCase();
                    document.getElementById('data-hoje').innerText = new Date().toLocaleDateString('pt-BR');

                    const qi = data.qi_score || 0;
                    const qe = data.qe_score || 0;

                    let p = (qi > 6 && qe > 6) ? "PotÃªncia Expansiva"
                          : (qi > 6) ? "Executor SolitÃ¡rio"
                          : (qe > 6) ? "Conector Nato"
                          : "Em ConstruÃ§Ã£o";

                    const txt = PERFIS[p];

                    document.getElementById('titulo-perfil').innerText = txt.titulo;
                    document.getElementById('subtitulo-perfil').innerText = txt.sub;
                    document.getElementById('texto-analise').innerText = txt.analise;
                    document.getElementById('texto-potencial').innerText = txt.potencial;
                    document.getElementById('texto-acao').innerText = txt.acao;

                }

            } catch (err) { console.error(err); }
        }


        /* ===== VERSÃƒO PRO PDF ===== */
        function baixarRelatorio(){

            const original = document.getElementById("area-relatorio");

            const clone = original.cloneNode(true);

            clone.style.width = "210mm";
            clone.style.height = "297mm";

            clone.style.maxWidth = "210mm";

            clone.style.margin = "0";
            clone.style.padding = "24px";

            clone.style.position = "fixed";
            clone.style.left = "0";
            clone.style.top = "0";

            clone.style.background = "#020617";

            clone.style.zIndex = "-9999";

            document.body.appendChild(clone);


            const opt = {

                margin:0,

                filename:'Relatorio_SierGrowth.pdf',

                image:{
                    type:'jpeg',
                    quality:1
                },

                html2canvas:{

                    scale:5,

                    dpi:300,

                    useCORS:true,

                    allowTaint:true,

                    letterRendering:true,

                    backgroundColor:'#020617',

                    scrollX:0,
                    scrollY:0,

                    windowWidth:794,
                    windowHeight:1123

                },

                jsPDF:{
                    unit:'mm',
                    format:'a4',
                    orientation:'portrait',
                    compress:true
                }

            };


            html2pdf()

            .set(opt)

            .from(clone)

            .save()

            .then(()=>{

                document.body.removeChild(clone);

            });

        }


        init();

    </script>

</body>
</html>
