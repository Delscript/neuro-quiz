<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relat√≥rio Oficial - SierComp4ny</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Allura&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: white; margin: 0; padding: 0; }
        .assinatura { font-family: 'Allura', cursive; font-size: 1.8rem; color: #60a5fa; }
        /* Garante que o fundo escuro seja capturado pelo PDF */
        #area-relatorio { background-color: #020617 !important; width: 100%; max-width: 600px; margin: 0 auto; }
        .no-print { display: flex; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4">

    <div id="area-relatorio" class="p-6 rounded-3xl border border-slate-800 shadow-2xl relative">
        
        <div class="flex justify-between items-start mb-8 border-b border-slate-800 pb-4">
            <div>
                <h1 class="text-xl font-black tracking-widest text-blue-500">SIERCOMP4NY</h1>
                <p class="text-[10px] text-slate-500 uppercase">Intelligence & <span class="text-orange-500 font-bold">Sier Growth</span></p>
            </div>
            <div class="text-right">
                <p class="text-[9px] opacity-60 uppercase">Relat√≥rio Confidencial</p>
                <p id="data-hoje" class="text-[10px] font-mono text-slate-400">--/--/----</p>
            </div>
        </div>

        <div class="text-center mb-8">
            <span class="bg-blue-900/30 text-blue-400 text-[10px] font-bold px-3 py-1 rounded-full border border-blue-500/30 uppercase">Resultado da An√°lise</span>
            <h2 id="titulo-perfil" class="text-3xl font-black text-white mt-4">---</h2>
            <p id="subtitulo-perfil" class="text-blue-400 italic text-sm mt-1">---</p>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-8">
            <div class="bg-slate-900 border border-slate-800 p-4 rounded-2xl text-center">
                <p class="text-[10px] text-slate-500 uppercase font-bold">Raz√£o (QI)</p>
                <div class="text-3xl font-black text-blue-500"><span id="score-qi">0</span><span class="text-sm text-slate-700">/10</span></div>
            </div>
            <div class="bg-slate-900 border border-slate-800 p-4 rounded-2xl text-center">
                <p class="text-[10px] text-slate-500 uppercase font-bold">Emo√ß√£o (QE)</p>
                <div class="text-3xl font-black text-purple-500"><span id="score-qe">0</span><span class="text-sm text-slate-700">/10</span></div>
            </div>
        </div>

        <div class="space-y-6 mb-10 text-justify">
            <div class="flex gap-3">
                <span class="text-xl">üëÅÔ∏è</span>
                <div>
                    <h3 class="font-bold text-sm text-white">O que ningu√©m v√™ em voc√™</h3>
                    <p id="texto-analise" class="text-[11px] text-slate-400 leading-relaxed mt-1">---</p>
                </div>
            </div>
            <div class="flex gap-3">
                <span class="text-xl">üöÄ</span>
                <div>
                    <h3 class="font-bold text-sm text-white">Seu Potencial M√°ximo</h3>
                    <p id="texto-potencial" class="text-[11px] text-slate-400 leading-relaxed mt-1">---</p>
                </div>
            </div>
            <div class="bg-blue-600/10 border-l-4 border-orange-500 p-4 rounded-r-xl">
                <h3 class="font-bold text-blue-400 text-xs mb-1">‚ö° Sua A√ß√£o Imediata</h3>
                <p id="texto-acao" class="text-[11px] text-blue-200 italic">---</p>
            </div>
        </div>

        <div class="pt-8 border-t border-slate-800 text-center">
            <p class="text-[10px] text-slate-600 uppercase tracking-widest mb-1">Certificamos a an√°lise de:</p>
            <h4 id="nome-cliente" class="text-2xl font-bold text-white mb-6">---</h4>
            
            <div class="flex flex-col items-center">
                <div class="assinatura">Anderson Dias</div>
                <div class="h-px w-32 bg-slate-700 my-2"></div>
                <p class="text-[8px] text-slate-500 uppercase tracking-tighter">
                    Dias Anderson ‚Ä¢ Founder & Lead Developer Sier Growth
                </p>
                <p class="text-[8px] font-mono text-slate-700 mt-2">ID: <span id="txid-display">---</span></p>
            </div>
        </div>
    </div>

    <div class="mt-8 mb-10 no-print">
        <button onclick="baixarRelatorio()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-10 rounded-full shadow-2xl flex items-center gap-2 transition-all active:scale-95">
            üì• BAIXAR RELAT√ìRIO COMPLETO
        </button>
    </div>

    <script>
        const SUPABASE_URL = "https://oabcppkojfmmmqhevjpq.supabase.co"; 
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9hYmNwcGtvamZtbW1xaGV2anBxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzMTE2ODEsImV4cCI6MjA4NTg4NzY4MX0.b2OlaVmawuwC34kXhLwbJMm6hnPsO7Hng0r8_AHjwhw"; 

        const PERFIS = {
            "Pot√™ncia Expansiva": { titulo: "O Vision√°rio", sub: "Equil√≠brio entre Raz√£o e Emo√ß√£o", analise: "Voc√™ processa dados frios sem perder o tato humano. Onde outros veem problemas, voc√™ enxerga o sistema inteiro.", potencial: "Lideran√ßa estrat√©gica e inova√ß√£o disruptiva.", acao: "Delegue o operacional. Sua mente vale ouro na estrat√©gia pura." },
            "Executor Solit√°rio": { titulo: "O Estrategista", sub: "Alta Precis√£o L√≥gica", analise: "Sua mente √© uma m√°quina de resolver problemas. Voc√™ disseca desafios complexos com frieza cir√∫rgica.", potencial: "Consultoria de alto n√≠vel e arquitetura t√©cnica.", acao: "Treine um bra√ßo direito. Voc√™ est√° limitando seu crescimento ao centralizar tudo." },
            "Conector Nato": { titulo: "O Diplomata", sub: "Intelig√™ncia Social Superior", analise: "Voc√™ l√™ pessoas como livros. Sua for√ßa est√° na influ√™ncia e na venda de grandes ideias.", potencial: "Negocia√ß√£o estrat√©gica e cultura corporativa.", acao: "Use processos r√≠gidos. Seu carisma abre portas, mas a disciplina as mant√©m abertas." },
            "Em Constru√ß√£o": { titulo: "Explorador", sub: "Fase de Transi√ß√£o", analise: "Sua intelig√™ncia detectou inconsist√™ncias produtivas. Voc√™ est√° em um momento de recalibragem interna.", potencial: "Vasto, mas exige foco em autoconhecimento.", acao: "Tente novamente com foco total na sua dor principal hoje." }
        };

        async function init() {
            try {
                const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                const params = new URLSearchParams(window.location.search);
                const txid = params.get('txid');

                if (!txid) return;

                const { data, error } = await supabase.from('leads').select('*').eq('txid', txid).single();
                if (data) {
                    document.getElementById('nome-cliente').innerText = data.nome;
                    document.getElementById('score-qi').innerText = data.qi_score || 0;
                    document.getElementById('score-qe').innerText = data.qe_score || 0;
                    document.getElementById('txid-display').innerText = txid.slice(0, 8).toUpperCase();
                    document.getElementById('data-hoje').innerText = new Date().toLocaleDateString('pt-BR');

                    const qi = data.qi_score || 0;
                    const qe = data.qe_score || 0;
                    let p = (qi > 6 && qe > 6) ? "Pot√™ncia Expansiva" : (qi > 6) ? "Executor Solit√°rio" : (qe > 6) ? "Conector Nato" : "Em Constru√ß√£o";

                    const txt = PERFIS[p];
                    document.getElementById('titulo-perfil').innerText = txt.titulo;
                    document.getElementById('subtitulo-perfil').innerText = txt.sub;
                    document.getElementById('texto-analise').innerText = txt.analise;
                    document.getElementById('texto-potencial').innerText = txt.potencial;
                    document.getElementById('texto-acao').innerText = txt.acao;
                }
            } catch (err) { console.error(err); }
        }

        function baixarRelatorio() {
            const element = document.getElementById('area-relatorio');
            const opt = {
                margin: 0,
                filename: 'Relatorio_SierGrowth.pdf',
                image: { type: 'jpeg', quality: 1 },
                html2canvas: { 
                    scale: 3, 
                    useCORS: true, 
                    backgroundColor: '#020617', // FOR√áA O FUNDO ESCURO NO PDF
                    scrollY: 0
                },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            html2pdf().set(opt).from(element).save();
        }

        init();
    </script>
</body>
</html>
